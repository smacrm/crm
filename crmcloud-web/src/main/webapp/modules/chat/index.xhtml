<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <h:form>
<div id="chat_form">
    <p:menuButton value="#{msg['label.group']}" iconPos="true" style="font-size: 85%">
        <p:menuitem value="Save"  icon="ui-icon-disk"/>
        <p:menuitem value="Update"  icon="ui-icon-arrowrefresh-1-w"/>
        <p:menuitem value="Delete"   icon="ui-icon-close"/>
    </p:menuButton>

    <p:menuButton value="#{msg['label.member']}" style="float: right;font-size: 85%">
        <p:menuitem value="Save"  icon="ui-icon-disk"/>
        <p:menuitem value="Update"  icon="ui-icon-arrowrefresh-1-w"/>
        <p:menuitem value="Delete"   icon="ui-icon-close"/>
    </p:menuButton>

<p:socket onMessage="handleMessage" channel="/{room}" autoConnect="false" widgetVar='subscriber' />

<p:panelGrid style="width: 100%;height: 100%;position: relative;">
<table style="position: absolute; left: 0; bottom: 0; right: 0;margin: 0;padding: 0;border: none;width: 100%">
    <tr>
        <td style="text-align: center">
<p:commandButton title="#{crmcloud['label.logout']}" ajax="true" action="#{login.doLogout}" icon="fa fa-fw fa-folder-open" />
        </td>
        <td style="text-align: center">
            <p:inputTextarea rows="1" autoResize="true" style="max-height: 5em" styleClass="messageInput" />
        </td>
        <td style="text-align: center;">
<p:commandButton title="#{crmcloud['label.logout']}" oncomplete="$('.messageInput').val('').focus()" icon="fa fa-fw fa-cloud-upload"/>
        </td>
    </tr>
</table>
</p:panelGrid>

</div>

<script type="text/javascript">
function handleMessage(message) {
    PF('widget_growl').renderMessage({"summary":message.user,"detail":message.text,"severity":"info"});

    var chatContent = $(PrimeFaces.escapeClientId('chat_form:public')),
    text = (message.user) ? message.user + ':' + message.text: message.text;
    chatContent.append(text + '<br />');
    //keep scroll
    chatContent.scrollTop(chatContent.height());
    if(message.updateList) {
        updateList();
    }
}
</script>
</h:form>
</ui:composition>
