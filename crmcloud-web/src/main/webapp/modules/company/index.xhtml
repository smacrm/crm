<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:crm="http://gnext.co.jp/facelets">
    <div id="pageTitle">#{companyBundle['label.company.header']} #{msg['symbol.paren.left']}#{companyBundle['label.company.header.list']}#{msg['symbol.paren.right']}</div>
    <h:form id="frmCompanyList">
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{companyBundle['label.company.header']}
                            <small>#{companyBundle['label.company.header.list']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.create']}" icon="fa fa-plus-circle" title="#{msg['label.create']}"
                                         actionListener="#{companyController.show}" update="mainContent"
                                         rendered="${sec.hasMethod('CompanyController', 'create')}"
                                         onstart="start()" onsuccess="finish()">
                            <f:param name="showType" value="create"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.download']}" title="#{msg['label.download']}" icon="fa fa-cloud-download"
                                       action="#{companyController.download('tblGroupCompanys',companyBundle['label.manager.list'])}" ajax="false"
                                       rendered="${sec.hasMethod('CompanyController', 'download')}">
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <p:outputPanel rendered="${sec.hasMethod('CompanyController', 'search')}">
            <div class="box box-solid box-search">
                <div class="box-header with-border" data-widget="collapse">
                    <h3 class="box-title">#{msg['label.search.title']}</h3>
                    #{msg['symbol.colon']}<code></code>
                    <div class="box-tools pull-right">
                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button>
                    </div>
                </div>
                <div class="box-body">
                    <div id="search-filter"></div>
                </div>
                <div class="box-footer text-center">
                    <h:inputText value="#{companyController.searchDataJson}" styleClass="searchDataJson" style="display: none"/>
                    <p:commandLink actionListener="#{companyController.search}" 
                                   style="display:none" styleClass="search-action" 
                                   onstart="start()" onsuccess="finish()" 
                                   update="mainContent, :growl"/>
                    <p:commandButton value="#{companyBundle['label.search']}" type="button" icon="fa fa-search" styleClass="btn-search"></p:commandButton>
                </div>
            </div>
        </p:outputPanel>
        <c:set var="rowsPerPageTemplate" value="#{configController.getConfig('DATATABLE_ROW_PER_PAGE')}" scope="session" />
        <c:set var="rows" value="#{configController.getConfig('DATATABLE_DEFAULT_PER_PAGE')}" scope="session" />
        <p:dataTable id="tblGroupCompanys" rowIndexVar="tblGroupCompanysRowIndex"
                     var="model" value="#{companyController.groupCompanys}"
                     styleClass="crmcloud_datatable" scrollable="true"
                     lazy="true" paginator="true" paginatorTemplate="#{layout.paginatorTemplate}" currentPageReportTemplate="#{layout.currentPageReportTemplate}"
                     rowsPerPageTemplate="#{rowsPerPageTemplate}" rows="#{rows}" pageLinks="5" rowHover="true" emptyMessage="#{msg['label.data.empty']}">
            <p:column style="width:30px" styleClass="table-action" exportable="false">     
                <p:commandLink actionListener="#{companyController.show}"
                               update="mainContent"
                               title="#{msg['label.edit']}" styleClass="ui-icon ui-icon-pencil"
                               onstart="start()" onsuccess="finish()"
                               rendered="${sec.hasMethod('CompanyController', 'update')}">
                    <f:param name="showType" value="edit"/>
                    <f:param name="companyId" value="#{model.company.companyId}"/>
                    <f:param name="force" value="true"/>
                </p:commandLink>
            </p:column>
            <c:if test="${loginController.member.superAdmin}">
                <p:column headerText="#{companyBundle['label.company.bussiness']}" styleClass="date-column" >                
                    <h:outputText value="#{model.bussinessName}" />
                </p:column>
            </c:if>
            <p:column headerText="#{companyBundle['label.company.name']}">                
                <p:commandLink value="#{model.company.companyName}" actionListener="#{companyController.show}"
                               update="mainContent" title="View details" styleClass="link"
                               onstart="start()" onsuccess="finish()">
                    <f:param name="rowNum" value="#{model.rowNum}"/>
                    <f:param name="showType" value="view"/>
                    <f:param name="companyId" value="#{model.company.companyId}"/>
                    <f:param name="force" value="true"/>
                </p:commandLink>
            </p:column>
            <p:column headerText="#{companyBundle['label.company.globalgroupflag']}" style="text-align: center;">                
                <p:selectBooleanCheckbox value="#{model.companyGlobalLocale}" disabled="true"/>
            </p:column>
            <p:column headerText="#{msg['label.memo']}">
                <p:inputTextarea
                    rows="2"
                    autoResize="false"
                    readonly="true"
                    value="#{model.company.companyMemo}"
                    style="width: 100%"
                    styleClass="font_weight_normal inputTextareaNotBorder" />
            </p:column>
            <p:column headerText="#{msg['label.creator']}">                
                <h:outputText value="#{model.company.creator.memberNameFirst}" />
            </p:column>
            <p:column headerText="#{msg['label.create.time']}" styleClass="date-column">                
                <h:outputText value="#{model.displayCreateDate}" />
            </p:column>
            <p:column headerText="#{msg['label.updater']}">                
                <h:outputText value="#{model.company.updator.memberNameFirst}" />
            </p:column>
            <p:column headerText="#{msg['label.update.time']}" styleClass="date-column">                
                <h:outputText value="#{model.displayUpdateDate}" />
            </p:column>
            <p:column headerText="#{companyBundle['label.company.unionkey']}" style="width: 120px;">
                <h:outputText value="#{model.company.companyUnionKey}" rendered="#{model.company.companyUnionKey > 0}" />
            </p:column>
            <p:column headerText="#{msg['label.state']}" styleClass="text-center status-column">                
                <crm:state state="#{model.company.companyDeleted}"/>
            </p:column>
        </p:dataTable>
        <h:outputScript library="js" name="search-filter.js"/>
        <script type="text/javascript">
            jQuery(document).ready(function ($) {
                var sf = $("#search-filter").searchFilter({
                    fields: [
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.name']}",
                            "name": 'c.companyName',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        },
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.post']}",
                            "name": 'c.companyPost',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        },
                        {
                            "type": "select",
                            "label": "#{companyBundle['label.company.search.city']}",
                            "name": 'c.companyCity',
                            'operator': ['EQ'],
                            "data": ${companyController.prefectureList}
                        },
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.address']}",
                            "name": 'c.companyAddress',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        },
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.address.kana']}",
                            "name": 'c.companyAddressKana',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        },
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.ip']}",
                            "name": 'c.companyGlobalIp',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        },
                        {
                            "type": "string",
                            "label": "#{companyBundle['label.company.search.memo']}",
                            "name": 'c.companyMemo',
                            'operator': ['EQ', 'LIKE', 'BLANK']
                        }
                    ],
                    data: $('.searchDataJson').val(),
                    displayQuery: true,
                    queryContainer: $("#search-filter").closest('.box.box-search').find('.box-header code'),
                    langs:{
                        AND: '#{msg['label.condition.and']}',
                        OR: '#{msg['label.condition.or']}',
                        LIKE: '#{msg['label.condition.like']}',
                        LIKE_START: '#{msg['label.condition.like_start']}',
                        LIKE_END: '#{msg['label.condition.like_end']}',
                        NOT_LIKE: '#{msg['label.condition.not_like']}',
                        BLANK: '#{msg['label.condition.blank']}',
                        NOT_BLANK: '#{msg['label.condition.not_blank']}'
                    }
                });

                $(".btn-search").click(function (event) {
                    event.preventDefault();
                    var data = sf.data('searchFilter').getData();
                    $('.searchDataJson').val(data);
                    $(".search-action").trigger('click');
                });
            });
        </script>
        <style>
         
        </style>
    </h:form>
</ui:composition>
