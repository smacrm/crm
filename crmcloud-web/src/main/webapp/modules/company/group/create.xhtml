<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <div id="pageTitle">#{companyBundle['label.group.title']} #{msg['symbol.paren.left']}#{msg['label.create']}#{msg['symbol.paren.right']}</div>
    <h:form id="fromGroup">
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{companyBundle['label.group.title']}
                            <small>#{companyBundle['label.group.title.edit']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.back']}" icon="fa fa-chevron-circle-left"
                                         actionListener="#{groupController.load}"
                                         title="#{msg['label.back']}" update="mainContent" process="@this"
                                         onstart="start()" onsuccess="finish()">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.save']}" icon="fa fa-check-circle"
                                         actionListener="#{groupController.save}"
                                         rendered="${sec.hasMethod('GroupController', 'create')}"
                                         title="#{msg['label.save']}" update="fromGroup mainContent :growl"
                                         onstart="start()" onsuccess="finish()">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box">
            <div class="box-body">
                <p:panelGrid id="pgGroup" styleClass="crmcloud-panelgrid">
                    
                    <!-- Hệ thống cũ khi dùng selecbox này nhằm mục đích cho super-admin tạo group cho công ty mới thêm -->
                    <!-- Hiện tại, khi tách DB sẽ tạo mới 1 group cho super-admin vào nên loại bỏ phần này. -->
                    <p:row rendered="#{sec.master}">
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.group.company.label']}" styleClass="required"/></p:column>
                        <p:column colspan="3">
                            <p:selectOneMenu value="#{groupController.groupModel.group.company.companyId}" filter="true" filterMatchMode="startsWith">
                                <p:ajax event="change" update="fromGroup" listener="#{groupController.onSuperAdminChangeCompany}" onstart="start()" onsuccess="finish()"/>
                                <f:selectItem itemLabel="" itemValue="" />
                                <f:selectItems value="#{groupController.listCompany}" var="c" itemValue="#{c.companyId}" itemLabel="#{c.companyName}"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:attribute name="title" value="#{companyBundle['label.group.company.label']}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{groupController.groupModel.group.company.companyName}"></p:outputLabel>
                        </p:column>
                    </p:row>
                    
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.group.role']}"/></p:column>
                        <p:column colspan="3">
                            <p:selectCheckboxMenu value="#{groupController.groupModel.roleIds}"
                                                  label="#{groupController.groupModel.displayRoleName}"
                                                  widgetVar="cbmRoleIds" id="roleIds"
                                                  filter="true" filterMatchMode="startsWith">
                                <f:selectItems value="#{groupController.roles}" var="role"
                                               itemValue="#{role.roleId}"
                                               itemLabel="#{role.roleName}"/>
                                <p:ajax event="toggleSelect" oncomplete="PF('cbmRoleIds').show()" update="roleIds" listener="#{groupController.handleChangeRole}" onstart="start()" onsuccess="finish()"/>
                                <p:ajax oncomplete="PF('cbmRoleIds').show()" update="roleIds" listener="#{groupController.handleChangeRole}" onstart="start()" onsuccess="finish()"/>
                            </p:selectCheckboxMenu>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.group.parent.name']}" /></p:column>
                        <p:column colspan="3" styleClass="group_tree">
                            <p:selectOneMenu value="#{groupController.groupModel.group.parent.groupId}"
                                             filter="true" filterMatchMode="startsWith">
                                <f:selectItem itemLabel="--" itemValue="" />
                                <f:selectItems value="#{groupController.groups}" var="group"
                                               itemValue="#{group.groupId}" itemLabel="#{group.groupName}" itemDescription="#{group.treeLevel.toString()}"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.group.name']}" styleClass="required"/></p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{groupController.groupModel.group.groupName}" styleClass="input_text" maxlength="45">
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="45"/>
                                <f:attribute name="title" value="#{companyBundle['label.group.name']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.memo']}"/></p:column>
                        <p:column colspan="3">
                            <p:inputTextarea value="#{groupController.groupModel.group.groupMemo}" styleClass="input_memo" maxlength="500">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="500"/>
                                <f:attribute name="title" value="#{msg['label.memo']}"/>
                            </p:inputTextarea>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </div>
        </div>
        <script type="text/javascript">
            $(document).ready(function(){
               $('.ui-selectonemenu-items-wrapper ul li').each(function(index){
                    var lv = $(this).attr('title');
                    var margin = 10 * lv;
                    $(this).css("margin-left",margin);
                    $(this).removeAttr('title');
                }); 
            });
        </script>
    </h:form>
</ui:composition>
