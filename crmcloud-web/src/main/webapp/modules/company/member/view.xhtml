<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <div id="pageTitle">#{companyBundle['label.member.information.title']} #{msg['symbol.paren.left']}#{msg['label.title.detail']}#{msg['symbol.paren.right']}</div>
    <h:form id="frmViewMemberInfo">
        <p:confirmDialog message="#{msg['label.dialog.confirm']}" header="#{msg['label.dialog.header']}"  widgetVar="confirmDeleteMember" id="confirmDeleteMember">  
            <p:commandButton value="#{msg['label.dialog.yes']}" onclick="PF('confirmDeleteMember').hide();" update="mainContent :growl"
                             actionListener="#{memberController.delete}" title="accept" icon="ui-icon-check">
                <f:param name="memberId" value="#{memberController.memberModel.member.memberId}"/>
                <f:param name="force" value="true"/>
            </p:commandButton>
            <p:commandButton value="#{msg['label.dialog.no']}" onclick="PF('confirmDeleteMember').hide();" type="button" title="close" icon="ui-icon-close"/>   
        </p:confirmDialog>
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{companyBundle['label.member.information.title']}
                            <small>#{msg['label.detail']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.back']}" icon="fa fa-chevron-circle-left" actionListener="#{memberController.load}"
                                         title="#{msg['label.back']}" update="mainContent"
                                         onstart="start()" onsuccess="finish()" rendered="${sec.hasMethod('MemberController', 'search')}">
                            <f:param name="showType" value="list"/>
                            <f:param name="force" value="true"/>
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.edit']}" icon="fa fa-pencil fa-fw"
                                         title="#{msg['label.edit']}"
                                         update="mainContent" actionListener="#{memberController.show}"
                                         id="btnEdit"
                                         onstart="start()" onsuccess="finish()"
                                         rendered="${sec.hasMethod('MemberController', 'update')}">
                            <f:param name="showType" value="edit"/>
                            <f:param name="memberId" value="#{memberController.memberModel.member.memberId}"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.delete']}" title="#{msg['label.delete']}"
                                         icon="fa fa-trash" onclick="PF('confirmDeleteMember').show();" type="button"
                                         rendered="${sec.hasMethod('MemberController', 'delete')}">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton title="#{msg['label.previous']}" icon="fa fa-angle-left" styleClass="ui-corner-left"
                                         actionListener="#{memberController.previousOne}"
                                         update="gridMemberInfo,btnNext,lblNextPre,btnPrevious,confirmDeleteMember"
                                         disabled="#{memberController.currentRowNum == 0}" id="btnNext"
                                         onstart="start()" onsuccess="finish()" rendered="#{sec.master}"/>
                        <p:commandButton value="#{memberController.currentRowNum + 1}/#{memberController.memberModels.rowCount}" 
                                         styleClass="ui-corner-none" id="lblNextPre"
                                         rendered="#{sec.master}"/>
                        <p:commandButton title="#{msg['label.next']}" icon="fa fa-angle-right" styleClass="ui-corner-right" id="btnPrevious"
                                         actionListener="#{memberController.nextOne}"
                                         update="gridMemberInfo,btnNext,lblNextPre,btnPrevious,confirmDeleteMember"
                                         disabled="#{memberController.currentRowNum == memberController.memberModels.rowCount -1 }"
                                         onstart="start()" onsuccess="finish()"
                                         rendered="#{sec.master}"/>

                        <p:commandButton value="#{msg['label.print']}" title="#{msg['label.print']}" icon="ui-icon-print" type="button" onstart="start()" onsuccess="finish()">
                            <p:printer target="gridMemberInfo"/>
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box box-solid box-view-mode">
            <div class="box-body">
                <p:panelGrid id="gridMemberInfo" styleClass="crmcloud-panelgrid">
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.company.name']}"/></p:column>
                        <p:column style="width:35%;">
                            <p:outputLabel value="#{memberController.memberModel.member.group.company.companyName}"/>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.menu.AuthorityController']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.viewRoleName}" rendered="#{!sec.isLoggedInOtherCompany(memberController.memberModel.member.memberId)}"/>
                            <p:outputLabel value="N/A" rendered="#{sec.isLoggedInOtherCompany(memberController.memberModel.member.memberId)}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.group.name']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.group.groupName}"/>
                        </p:column>
                        <p:column rowspan="4"  styleClass="label-field"><p:outputLabel value="#{msg['label.logo']}" /></p:column>
                        <p:column rowspan="4">
                            <p:graphicImage value="#{memberController.fileUploader.streamedContent}" cache="false"
                                            style="float: left; width: 50px; height: 50px;" rendered="#{memberController.fileUploader.hasImage}"/>   
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.loginId']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberLoginIdDisplay}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.password']}"/></p:column>
                        <p:column >
                            <p:password style="border: none;" redisplay="true" value="#{memberController.memberModel.member.memberPassword}" disabled="true"/>
                        </p:column> 
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.code']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberCode}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.firstname']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberNameFirst}"/>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.lastname']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberNameLast}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.firstname.kana']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberKanaFirst}"/>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.lastname.kana']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberKanaLast}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.zipcode']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberPost}"/>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.city']}"/></p:column>
                        <p:column><p:outputLabel value="#{memberController.memberModel.displayMemberCity}" /></p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.address']}"/></p:column>
                        <p:column colspan="3">
                            <p:outputLabel value="#{memberController.memberModel.member.memberAddress}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.address.kana']}"/></p:column>
                        <p:column colspan="3">
                            <p:outputLabel value="#{memberController.memberModel.member.memberAddressKana}"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="vertical-align: top">
                            <p:dataList value="#{memberController.memberModel.memberPhones}" var="phone" rowIndexVar="rowIndex" type="definition"
                                        rendered="#{not empty memberController.memberModel.memberPhones}" class="crmcloud-datalist">
                                <p:panelGrid styleClass="panel-grid">
                                    <p:row>
                                        <p:column styleClass="label-field">
                                            <p:outputLabel value="#{msg['label.phone']}"
                                                           rendered="#{(memberController.memberModel.memberPhones.size()==1)}"/>
                                            <p:outputLabel value="#{msg['label.phone']}#{rowIndex+1}"
                                                           rendered="#{(memberController.memberModel.memberPhones.size()>1)}"/>
                                        </p:column>
                                        <p:column>
                                            <p:outputLabel value="#{phone.companyTargetData}" style="float:left;"></p:outputLabel>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </p:dataList>
                        </p:column>
                        <p:column colspan="2" style="vertical-align: top">
                            <p:dataList value="#{memberController.memberModel.memberMobilePhones}" var="mobilePhones" rowIndexVar="rowIndex" type="definition"
                                        rendered="#{not empty memberController.memberModel.memberMobilePhones}" class="crmcloud-datalist">
                                <p:panelGrid styleClass="panel-grid">
                                    <p:row>
                                        <p:column  styleClass="label-field">
                                            <p:outputLabel value="#{msg['label.mobile.phone']}"
                                                           rendered="#{(memberController.memberModel.memberMobilePhones.size()==1)}"/>
                                            <p:outputLabel value="#{msg['label.mobile.phone']}#{rowIndex+1}"
                                                           rendered="#{(memberController.memberModel.memberMobilePhones.size()>1)}"/>
                                        </p:column>
                                        <p:column>
                                            <p:outputLabel value="#{mobilePhones.companyTargetData}"></p:outputLabel>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </p:dataList>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="vertical-align: top">
                            <p:dataList value="#{memberController.memberModel.memberEmails}" var="email" rowIndexVar="rowIndex" type="definition"
                                        class="crmcloud-datalist" rendered="#{not empty memberController.memberModel.memberEmails}">
                                <p:panelGrid styleClass="panel-grid">
                                    <p:row>
                                        <p:column  styleClass="label-field">
                                            <p:outputLabel value="#{msg['label.email']}"
                                                           rendered="#{(memberController.memberModel.memberEmails.size()==1)}"/>
                                            <p:outputLabel value="#{msg['label.email']}#{rowIndex+1}"
                                                           rendered="#{(memberController.memberModel.memberEmails.size()>1)}"/>
                                        </p:column>
                                        <p:column>
                                            <p:outputLabel value="#{email.companyTargetData}" style="float:left;"></p:outputLabel>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                            </p:dataList>
                        </p:column>
                        <p:column colspan="2" style="vertical-align: top">
                            <div  class="ui-datalist ui-widget crmcloud-datalist">
                                <div  class="ui-datalist-content ui-widget-content">
                                    <dl  class="ui-datalist-data"><dt class="ui-datalist-item">
                                            <p:panelGrid styleClass="panel-grid" >
                                                <p:row>
                                                    <p:column styleClass="label-field">
                                                        <p:outputLabel value="#{companyBundle['label.member.administrator']}"/>
                                                    </p:column>
                                                    <p:column >
                                                        <h:outputText value="#{companyBundle['label.member.manager']}" rendered="#{memberController.memberModel.member.memberManagerFlag==1}" />
                                                        <h:outputText value="#{companyBundle['label.member.general']}" rendered="#{memberController.memberModel.member.memberManagerFlag==0}" />
                                                        <h:outputText value=" #{memberController.memberModel.displaymemberGroupRelIds}" rendered="#{memberController.memberModel.member.memberManagerFlag==1 and 
                                                                                memberController.memberModel.displaymemberGroupRelIdsFlag}"/>
                                                    </p:column>
                                                </p:row>
                                            </p:panelGrid>
                                        </dt>
                                    </dl>
                                </div>
                            </div>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.layout']}"/></p:column>
                        <p:column >
                            <p:outputLabel value="#{memberController.memberModel.member.memberLayout}"/>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{companyBundle['label.member.permission']}"/></p:column>
                        <p:column >
                            <p:selectBooleanCheckbox value="#{memberController.memberModel.asMemberFirewallFlag}" disabled="true"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <!-- hungpd 20161216 2FA -->
                        <p:column styleClass="label-field" rendered="#{memberController.memberModel.member.group.company.usingTwoFactor}">
                            <p:outputLabel value="#{msg['label.2fa']}"/>
                        </p:column>
                        <p:column rendered="#{memberController.memberModel.member.group.company.usingTwoFactor}">
                            <p:inputSwitch value="#{memberController.memberModel.member.using2FA}" 
                                           onLabel="#{msg['label.2fa.on']}" offLabel="#{msg['label.2fa.off']}" disabled="true" style="width: 40px">
                            </p:inputSwitch>
                        </p:column>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.memo']}"/></p:column>
                        <p:column>
                            <p:outputLabel value="#{memberController.memberModel.member.memberMemo}" style="word-break: break-all"/>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{companyBundle['label.member.company.group']}"/>
                        </p:column>
                        <p:column colspan="3">
                            <table>
                                <tr>
                                    <td>
                                        <p:selectBooleanCheckbox value="#{memberController.memberModel.asMemberGlobalFlag}" disabled="true"></p:selectBooleanCheckbox>
                                    </td>
                                    <td>
                                        <p:outputPanel id="colGroupCompanys">
                                            <h:panelGrid columns="4" cellpadding="20" style="margin-left: 5px;" cellspacing="20" rendered="#{memberController.memberModel.asMemberGlobalFlag}">
                                                <p:column style="width: 30px">
                                                    <p:outputLabel value="#{companyBundle['label.company.name']}" style="width: 40px"/>
                                                </p:column>
                                                <p:column style="width: 30px">
                                                    <p:selectOneMenu value="#{memberController.selectCompanyGroupId}" filter="true" filterMatchMode="startsWith" disabled="#{!memberController.memberModel.asMemberGlobalFlag}"> <f:selectItem itemLabel="" itemValue="0"/>
                                                        <f:selectItems value="#{memberController.companyBelongGroup}" var="company" itemValue="#{company.companyId}" itemLabel="#{company.companyName}"/>
                                                        <p:ajax listener="#{memberController.onChangeCompanyGroup}" onstart="start()" onsuccess="finish()" update="selectGroupOnCompanyGroupId"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                                <p:column style="width: 30px">
                                                    <p:outputLabel value="#{companyBundle['label.group.name']}" style="width: 50px; padding-left: 10px;"/>
                                                </p:column>
                                                <p:column style="width: 30px">
                                                    <p:selectOneMenu value="#{memberController.selectGroupOnCompanyGroupId}" filter="true" filterMatchMode="startsWith" disabled="#{!memberController.memberModel.asMemberGlobalFlag}" id="selectGroupOnCompanyGroupId">
                                                        <f:selectItem itemLabel="" itemValue="0"/>
                                                        <f:selectItems value="#{memberController.groupOnCompanyGroups}" var="group" itemValue="#{group.groupId}" itemLabel="#{group.groupName}"/>
                                                        <p:ajax listener="#{memberController.onChangeGroupOfCompanyGroup}" onstart="start()" onsuccess="finish()"/>
                                                    </p:selectOneMenu>
                                                </p:column>
                                            </h:panelGrid>
                                        </p:outputPanel>
                                    </td>
                                </tr>
                            </table>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </div>
        </div>
    </h:form>
</ui:composition>
