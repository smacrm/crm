<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<h:panelGrid width="100%" styleClass="page-header">
    <f:facet name="header">
        <div class="row">
            <div class="col-md-4">
                <h1>
                    ${issue['label.page.issue']}
                    <small style="display: inline-flex;background: transparent;">
                        <p:outputLabel value="${msg['label.edit']}" style="margin-right: 0.5em !important" />
                        <h:outputLabel
                            styleClass="outputLabelLamp"
                            style="background: ##{issueController.issue.lampColor};color: ##{issueController.issue.lampTextColor}"
                            value="#{issueLampController.getLampNameByColor(issueController.issue.lampColor)}"
                            rendered="#{!empty issueController.issue.lampColor}"/>
                    </small>
                </h1>
            </div>
            <div class="col-md-8 text-right">
                <p:commandButton
                    value="${msg['label.cancel']}"
                    actionListener="#{issueController.backTo}"
                    update=":mainContent ,:growl"
                    icon="fa fa-eye"
                    process="@this"
                    rendered="#{(sec.isMaster() or sec.hasMethod('IssueController', 'view'))}"
                    onstart="start()" onsuccess="finish()">
                    <!--<p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>-->
                    <f:actionListener binding="#{issueController.unHoldIssue()}"/>
                    <f:param name="backURL" value="/modules/issue/show.xhtml" />
    <!--                <f:param name="issueIdx" value="#{issueController.issueIdx}" />-->
                    <f:param name="id" value="#{issueController.issue.issueId}" />
                    <f:param name="force" value="true"/>
                </p:commandButton>
                <p:commandButton
                    actionListener="#{issueController.update()}"
                    update=":mainContent ,:growl" styleClass="hide btn-issue-update"
                    rendered="#{(sec.isMaster() or sec.hasMethod('IssueController', 'update'))}"
                    onstart="start()" onsuccess="finish()" >
                    <f:param name="force" value="true"/>
                    <f:param name="id" value="#{issueController.issue.issueId}" />
                </p:commandButton>
                
                <!-- cac button an de thuc hien xu ly theo issue status -->
                <p:commandLink id="cmdCustomerSupportMail"
                    actionListener="#{issueCustSupportController.create()}"
                    update=":panelCustomerSupportMail"
                    oncomplete="PF('dlgCustomerSupportMail').show();"
                    process="@this"
                    styleClass="hide"
                    onstart="start()" onsuccess="finish()">
                    <i class="fa fa-user-md"></i>
                    <h:outputLabel value="${issue['label.escalation_4']}" />
                </p:commandLink>
                
                <p:commandLink id="cmdSendSupportMail"
                    actionListener="#{issueSupportController.create('1')}"
                    oncomplete="PF('dlgSendSupportMail').show();"
                    update=":panelGridDialogMailSupport"
                    process="@this"
                    styleClass="hide"
                    onstart="start()" onsuccess="finish()">
                    <f:param name="issueId" value="${issueController.issue.issueId}" />
                </p:commandLink>

                <p:commandLink id="cmdSendComment"
                    actionListener="#{issueCommentController.create()}"
                    update=":panelSendComment"
                    oncomplete="PF('dlgCommentMail').show();"
                    process="@this"
                    styleClass="hide"
                    onstart="start()" onsuccess="finish()">
                    <h:outputLabel value="${issue['label.escalation_3']}" />
                </p:commandLink>

                <p:commandButton id="cmdSupport"
                    rendered="#{(sec.isMaster() or sec.hasMethod('IssueSupportController', 'REQUESTMAIL'))}"
                    actionListener="#{issueSupportController.create('2')}"
                    update=":inputTextRequestMailSubject, :inputTextareaRequestMailBody, :inputTextareaRequestMailFooter, :panel_to_d_o_users, :panel_cc_d_o_users, :panel_bcc_d_o_users"
                    oncomplete="PF('dlgSendRequestMail').show();"
                    process="@this" styleClass="hide"
                    onstart="start()" onsuccess="finish()">
                    <f:param name="issueId" value="${issueController.issue.issueId}" />
                </p:commandButton>
                <!-- cac button an -->
                
                <p:commandButton
                    onclick="doValidateAndSubmitIssue($('.btn-issue-update'), '#{msg['javax.faces.component.UIInput.REQUIRED']}')"
                    value="${msg['label.update']}"
                    icon="fa fa-check-circle" id="issue_update_button"
                    rendered="#{(sec.isMaster() or sec.hasMethod('IssueController', 'update'))}">
                </p:commandButton>

                <c:if test="${!empty issueController.issueIdx and  !empty issueController.ais.issues}">
                    <p:panel id="panelSizeCount" styleClass="ui-buttonset ui-widget divPanelSizeCount">
                        <c:if test="${!empty issueController.issueIdx and issueController.issueIdx > 0}">
                            <p:commandButton
                                action="#{issueController.updateSkip}"
                                oncomplete="reRenderDynamicForm();"
                                value="#{msg['label.update.pre']}"
                                styleClass="hide btn-update-prev"
                                onstart="start()" onsuccess="finish()"
                                update="issuePrintBlock, @this:panelSizeCount ,:growl"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}">
                                <f:param name="force" value="true"/>
                                <f:param name="issueIdx" value="#{issueController.issueIdx-1}"/>
                            </p:commandButton>
                            <p:commandButton
                                onclick="doValidateAndSubmitIssue($('.btn-update-prev'), '#{msg['javax.faces.component.UIInput.REQUIRED']}')"
                                value="#{msg['label.update.pre']}"
                                icon="fa fa-angle-left"
                                styleClass="ui-corner-left"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}">
                            </p:commandButton>
                            <p:commandButton
                                action="#{issueController.skip('edit')}"
                                oncomplete="reRenderDynamicForm();"
                                process="@this"
                                title="#{msg['label.previous']}"
                                icon="fa fa-angle-left"
                                styleClass="ui-corner-left"
                                onstart="start()" onsuccess="finish()"
                                update="issuePrintBlock, @this:panelSizeCount ,:growl"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}" >
                                <f:param name="force" value="true"/>
                                <f:param name="issueIdx" value="#{issueController.issueIdx-1}"/>
                            </p:commandButton>
                        </c:if>
                        <p:commandButton
                            value="${issueController.issueIdx+1}/${issueController.ais.issues.size()}"
                            styleClass="ui-corner-none"
                            rendered="#{sec.master or sec.hasMethod('IssueController', 'update') or sec.hasMethod('IssueController', 'view')}"/>
                        <c:if test="${!empty issueController.issueIdx and issueController.issueIdx ne issueController.ais.issues.size()-1}">
                            <p:commandButton
                                action="#{issueController.skip('edit')}"
                                oncomplete="reRenderDynamicForm();"
                                process="@this"
                                title="#{msg['label.next']}"
                                icon="fa fa-angle-right"
                                styleClass="ui-corner-right"
                                onstart="start()" onsuccess="finish()"
                                update="issuePrintBlock, @this:panelSizeCount ,:growl"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}" >
                                <f:param name="force" value="true"/>
                                <f:param name="issueIdx" value="#{issueController.issueIdx + 1}"/>
                            </p:commandButton>
                            <p:commandButton
                                action="#{issueController.updateSkip}"
                                oncomplete="reRenderDynamicForm();"
                                value="#{msg['label.update.next']}"
                                styleClass="hide btn-update-next"
                                onstart="start()" onsuccess="finish()"
                                update="issuePrintBlock, @this:panelSizeCount ,:growl"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}" >
                                <f:param name="force" value="true"/>
                                <f:param name="issueIdx" value="#{issueController.issueIdx + 1}"/>
                            </p:commandButton>
                            <p:commandButton
                                onclick="doValidateAndSubmitIssue($('.btn-update-next'), '#{msg['javax.faces.component.UIInput.REQUIRED']}')"
                                value="#{msg['label.update.next']}"
                                icon="fa fa-angle-right"
                                styleClass="ui-corner-right"
                                rendered="#{sec.master or sec.hasMethod('IssueController', 'update')}">
                            </p:commandButton>
                        </c:if>
                    </p:panel>
                </c:if>
            </div>
        </div>
    </f:facet>
</h:panelGrid>

<!-- LAMP色を取得 -->
<!--<ui:include src="/modules/issue/common/issue_lamp_script.xhtml" />-->
</ui:composition>