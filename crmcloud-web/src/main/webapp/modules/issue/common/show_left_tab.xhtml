<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <p:tabView id="tabViewIssue" scrollable="false">
        <c:if test="#{loginController.member.companyStoreMode}">
            <c:set var="customerList" value="#{issueController.issue.customerList}"/>
            <c:forEach var="customer" items="#{customerList}" varStatus="tabIndex" begin="0" end="1">
                <p:tab id="cust_#{customer.tabIdx}">
                    <ui:include src="/modules/issue/common/show_customer.xhtml" >
                        <ui:param name="customerIndex" value="#{tabIndex.index}"/>
                    </ui:include>
                </p:tab>
            </c:forEach>
        </c:if>
        
        <c:if test="#{!loginController.member.companyStoreMode}">
            <ui:include src="/modules/issue/common/show_info_tab.xhtml"/>
        </c:if>

        <ui:include src="/modules/customize/tab.xhtml">
            <ui:param name="tabList" value="#{issueController.customizeForm}"/>
            <ui:param name="mode" value="readonly"/>
        </ui:include>

        <p:tab id="tabViewRelatedCases" rendered="#{sec.isMaster() or sec.hasMethod('IssueController', 'RELATED')}">
            <f:facet name="title">
                ${issue['label.tab_related_cases']} 
                <h:outputText
                    id="tabViewRelatedCasesTitle"
                    value="(${issueController.issue.relatedCases.size()}${issue['label.count']})" />
            </f:facet>
            <ui:include src="related_cases.xhtml" />
        </p:tab>
        <p:tab id="tabViewcFileActtachment" rendered="#{sec.isMaster() or sec.hasMethod('IssueAttachmentController', 'SEARCH')}">
            <f:facet id="facetTodoTitle" name="title">${issue['label.attachment.title']}</f:facet>
            <ui:include src="issue_attachment.xhtml" >
                <ui:param name="mode" value="view"/>
            </ui:include>
        </p:tab>
        <p:tab id="tabViewTodoList" class="tabViewTodoList" rendered="#{sec.isMaster() or sec.hasMethod('IssueTodoController', 'SEARCH')}">
            <f:facet name="title">
                ${issue['label.tab_todo_list']} 
                <h:outputText id="tabViewTodoListTitle" value="(${issueController.issue.issueTodoList.size()}${issue['label.count']})" />
            </f:facet>
            <ui:include src="todo_list.xhtml" />
        </p:tab>
    </p:tabView>

    <!-- 対応履歴 -->
    <ui:include src="/modules/issue/common/show_escalation_list.xhtml" />
</ui:composition>
