<ui:composition
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <p:remoteCommand name="setLoadCustomerClick" actionListener="#{customerController.edit}" />
    <p:panelGrid style="width: 100%;" id="panelGrid_customerSpecials" styleClass="dataTable_history_customer">
        <f:facet name="header">
            <p:row>
                <p:column>
                    <h:outputLabel value="${issue['label.cust_special_id']}" />
                </p:column>
                <p:column>
                    <h:outputLabel value="${issue['label.cust_special_name']}" />
                </p:column>
                <p:column>
                    <h:outputLabel value="${issue['label.name_hira']}" />
                </p:column>
                <p:column>
                    <h:outputLabel value="${issue['label.name_kana']}" />
                </p:column>
            </p:row>
            <p:row>
                <p:column>
                    <h:outputLabel value="${issue['label.post']}" />
                </p:column>
                <p:column>
                    <h:outputLabel value="${issue['label.city']}" />
                </p:column>
                <p:column colspan="2">
                    <h:outputLabel value="${issue['label.address']}" />
                </p:column>
            </p:row>
            <p:row>
                <p:column>
                    <h:outputLabel value="${issue['label.tel']}" />
                </p:column>
                <p:column>
                    <h:outputLabel value="${issue['label.mobile']}" />
                </p:column>
                <p:column colspan="2">
                    <h:outputLabel value="${issue['label.mail']}" />
                </p:column>
            </p:row>
            <p:row>
                <p:column colspan="4">
                    <h:outputLabel value="${issue['label.memo']}" />
                </p:column>
            </p:row>
        </f:facet>
        <c:forEach var="customerSpecials" items="#{issueController.issue.historySpecials}" varStatus="sIndex">
            <p:row>
                <p:column>
                    <h:outputFormat rendered="#{customerList.size() eq 1}">
                        <p:commandButton icon="fa fa-arrow-circle-left" update="tabViewCustomer"
                            actionListener="#{customerController.moveToIssue(customerSpecials, 0)}"
                            oncomplete="$('#tabViewCustomer li:first').click();"
                            rendered="#{renderButton ne 'no'}">
                        </p:commandButton>
                    </h:outputFormat>
                    <h:outputFormat rendered="#{customerList.size() gt 1}">
                        <p:commandButton id="movetoissue_#{customerSpecials.custId}" icon="fa fa-arrow-circle-left" rendered="#{renderButton ne 'no'}">
                        </p:commandButton>
                        <p:tieredMenu overlay="true" trigger="movetoissue_#{customerSpecials.custId}" my="left top" at="left bottom" style="width:100px">
                            <c:forEach begin="0" end="#{customerList.size()-1}" var="index" varStatus="index2">
                                <p:menuitem value="#{issue['label.page.customer']} #{index eq 0 ? '' : index2.index}" icon="fa fa-arrow-circle-left"  update="tabViewCustomer" 
                                        actionListener="#{customerController.moveToIssue(customerSpecials, index2.index)}"
                                        oncomplete="$('#tabViewCustomer li:eq(#{index2.index})').click();"/>
                            </c:forEach>
                        </p:tieredMenu>
                    </h:outputFormat>
                    <p:spacer width="5" rendered="#{renderButton ne 'no'}"/>
                    <p:commandLink
                        actionListener="${dialogController.openCustDialog(customerSpecials.custId, true)}"
                        onclick="setLoadCustomerClick([{name: 'custId', value: ${customerSpecials.custId}}]);"
                        onstart="start()" onsuccess="finish()"
                        process="@this">
                        <h:outputLabel value="${customerSpecials.custId}" styleClass="cursor" />
                        <f:param name="width" value="800" />
                        <f:param name="height" value="450" />
                        <f:param name="custId" value="${customerSpecials.custId}" />
                    </p:commandLink>
                </p:column>
                <p:column>
                    <h:outputLabel value="${customerSpecials.custSpecialId.getItemViewData(localeController.locale)}" styleClass="font_weight_normal"/>
                </p:column>
                <p:column>
                    <h:outputLabel value="${customerSpecials.custFirstHira}" styleClass="font_weight_normal"/>
                    <h:outputLabel value=" - ${customerSpecials.custLastHira}" rendered="${!empty customerSpecials.custLastHira}" styleClass="font_weight_normal"/>
                </p:column>
                <p:column>
                    <h:outputLabel value="${customerSpecials.custFirstKana}" styleClass="font_weight_normal"/>
                    <h:outputLabel value=" - ${customerSpecials.custLastKana}" rendered="${!empty customerSpecials.custLastKana}" styleClass="font_weight_normal"/>
                </p:column>
            </p:row>

            <p:row>
                <p:column>
                    <h:outputLabel value="${customerSpecials.custPost}" styleClass="font_weight_normal"/>
                </p:column>
                <p:column>
                    <h:outputLabel value="${customerSpecials.custCity.prefectureName}" styleClass="font_weight_normal"/>
                </p:column>
                <p:column colspan="2">
                    <h:outputLabel value="${customerSpecials.custAddress}" styleClass="font_weight_normal" />
                </p:column>
            </p:row>

            <p:row>
                <p:column>
                    <c:forEach var="telSpecials" items="#{customerSpecials.tel}">
                        <h:outputLabel value="${telSpecials.custTargetData}" styleClass="outputLabel_display_block font_weight_normal" />
                    </c:forEach>
                </p:column>
                <p:column>
                    <c:forEach var="mobileSpecials" items="#{customerSpecials.mobile}">
                        <h:outputLabel value="${mobileSpecials.custTargetData}" styleClass="outputLabel_display_block font_weight_normal" />
                    </c:forEach>
                </p:column>
                <p:column colspan="2">
                    <c:forEach var="mailSpecials" items="#{customerSpecials.mail}">
                        <h:outputLabel value="${mailSpecials.custTargetData}" styleClass="outputLabel_display_block font_weight_normal" />
                    </c:forEach>
                </p:column>
            </p:row>

            <p:row>
                <p:column colspan="4">
                    <p:inputTextarea
                        rows="3"
                        autoResize="false"
                        readonly="true"
                        value="${customerSpecials.custMemo}"
                        style="width: 100%"
                        styleClass="font_weight_normal inputTextareaNotBorder" />
                </p:column>
            </p:row>
        </c:forEach>
    </p:panelGrid>
</ui:composition>
