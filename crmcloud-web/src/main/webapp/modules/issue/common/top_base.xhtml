<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
    <p:panelGrid styleClass="panelGrid_topBase panelGrid_td_line_height ui-panelgrid-color" style="width: 100%;">
        <p:row>
            <p:column styleClass="td_10"><h:outputLabel value="${issue['label.issue_code']}" /></p:column>
            <p:column styleClass="td_15">
                <h:outputLabel value="${issueController.issue.issueViewCode}" rendered="${!empty issueController.issue.issueViewCode}" />
            </p:column>
            <p:column styleClass="td_10">
                <h:outputLabel value="${issue['label.issue_receive_name']}" />
            </p:column>
            <p:column styleClass="td_15">
                <p:selectOneMenu value="#{issueController.issue.issueReceiveId}" converter="gnext.converter.smart">
                    <f:selectItems value="#{issueController.select.get('issue_receive_id')}"/>
                </p:selectOneMenu>
            </p:column>
            <p:column styleClass="td_10">
                <h:outputLabel value="${issue['label.created_name']}" />
                <font>*</font>
            </p:column>
            <p:column styleClass="td_15">
                <p:commandButton id="issueCreatorPersonList" type="button" icon="fa fa-th" styleClass="menu-toggle"/>
                <label id="label_issue_creator_id" class="font_weight_normal" >#{issueController.issue.creatorId.memberNameFull}</label>
                <p:tieredMenu
                    overlay="true"
                    trigger="issueCreatorPersonList"
                    widgetVar="widgetIssueCreatorPersonList"
                    my="left top"
                    at="left bottom"
                    model="#{issueController.selects.get('issue_creator_id')}"
                    a:ref="#label_issue_creator_id"/>
            </p:column>
            <p:column styleClass="td_10">
                <h:outputLabel value="${issue['label.updated_name']}" />
            </p:column>
            <p:column styleClass="td_15">
                <label class="font_weight_normal" >${issueController.issue.updatedId.memberNameFull}</label>
            </p:column>
        </p:row>
        <p:row>
            <p:column>
                <h:outputLabel value="${issue['label.issue_receive_date']}" />
                <font>*</font>
            </p:column>
            <p:column>
                <p:calendar
                    id="issue_receive_date"
                    label="${issue['label.issue_receive_date']}"
                    locale="#{loginController.member.locale}"
                    value="#{issueController.issue.issueReceiveDate}"
                    pattern="yyyy/MM/dd HH:mm"
                    showOn="button"
                    styleClass="input_datetime">
                    <f:attribute name="title" value="#{issue['label.issue_receive_date']}"/>
                </p:calendar>
            </p:column>
            <p:column>
                <h:outputLabel value="${issue['label.issue_receive_person_name']}" />
                <font>*</font>
            </p:column>
            <p:column>
                <p:commandButton id="issueReceivePersonList" type="button" icon="fa fa-th" styleClass="menu-toggle" />
                <label id="label_issue_receive_person_id" class="font_weight_normal" >${issueController.issue.issueReceivePerson.memberNameFull}</label>
                <p:tieredMenu
                    overlay="true"
                    trigger="issueReceivePersonList"
                    widgetVar="widgetIssueReceivePersonList"
                    my="left top"
                    at="left bottom"
                    model="#{issueController.selects.get('issue_receive_person_id')}"
                    a:ref="#label_issue_receive_person_id"/>
            </p:column>
            <p:column>
                <h:outputLabel value="${issue['label.created_time']}" />
            </p:column>
            <p:column>
                <h:outputLabel value="${issueController.issue.createdTime}" styleClass="font_weight_normal" >
                    <f:convertDateTime type="date" pattern="yyy/MM/dd"/>
                </h:outputLabel>
            </p:column>
            <p:column><h:outputLabel value="${issue['label.updated_time']}" /></p:column>
            <p:column>
                <h:outputLabel value="${issueController.issue.updatedTime}" styleClass="font_weight_normal" >
                    <f:convertDateTime type="date" pattern="yyyy/MM/dd"/>
                </h:outputLabel>
            </p:column>
        </p:row>
        <p:row>
            <p:column>
                <h:outputLabel value="${issue['label.issue_authorizer_name']}" />
            </p:column>
            <p:column>
                <p:panel id="panelCommandLinkAuthorizerName" style="border: none;">
                    <p:commandButton
                        actionListener="#{issueController.getLoginUserName}"
                        process="@this"
                        icon="fa fa-check-circle-o"  
                        update=":issueAuthorizerName, :panelCommandLinkAuthorizerName" />
                    <h:outputLabel id="issueAuthorizerName" value="#{issueController.issue.issueAuthorizerId.memberNameFull}" style="font-weight: normal;margin-top: 0.5em;" />
                    <p:commandLink
                        actionListener="#{issueController.deleteAuthorizedUser()}"
                        onclick="$(this).hide('slow');"
                        update=":issueAuthorizerName"
                        rendered="${!empty issueController.issue.issueAuthorizerId.memberNameFull}"
                        process="@this"
                        styleClass="btn btn-xs btn-default fa fa-minus-circle"
                        style="float: right;margin-top: 0.3em;padding: 0.3em;" />
                </p:panel>
            </p:column>
            <p:column>
                <h:outputLabel value="${issue['label.issue_status_name']}" />
                <font>*</font>
            </p:column>
            <p:column>
                <p:selectOneMenu value="#{issueController.issue.issueStatusId}" converter="gnext.converter.smart" id="issue_status_id" widgetVar="issue_status_id">
                    <f:selectItems value="#{issueController.select.get('issue_status_id')}"/>
                </p:selectOneMenu>
            </p:column>
            <p:column>
                <h:outputLabel value="${issue['label.issue_closed_date']}" />
            </p:column>
            <p:column>
                <p:calendar id="issue_close_date"
                            label="${issue['label.issue_closed_date']}"
                            value="#{issueController.issue.issueClosedDate}"
                            locale="#{loginController.member.locale}"
                            pattern="yyyy/MM/dd HH:mm"
                            showOn="button"
                            styleClass="input_datetime" />
            </p:column>
            <p:column>
                <h:outputLabel value="${issue['label.issue_public_name']}" />
                <font>*</font>
            </p:column>
            <p:column>
                <p:selectOneButton value="#{issueController.issue.issuePublicId}" style="border-left: 0 !important;" converter="gnext.converter.smart" id="issue_public_id">
                    <f:selectItems value="#{issueController.select.get('issue_public_id')}" />
                </p:selectOneButton>
            </p:column>
        </p:row>
    </p:panelGrid>
    <!-- 進捗状況 -->
    <c:if test="#{issueController.issue.issueId!=null and issueController.issue.issueId>0}">
        <ui:include src="/modules/issue/common/issue_status.xhtml"/>
    </c:if>
</ui:composition>
