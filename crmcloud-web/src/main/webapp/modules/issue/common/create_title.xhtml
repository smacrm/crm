<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <h:panelGrid width="100%" styleClass="page-header">
        <f:facet name="header">
            <div class="row">
                <div class="col-md-6">
                    <h1>${issue['label.page.issue']}<small>${msg['label.create']}</small></h1>
                </div>
                <div class="col-md-6 text-right">
                    <p:commandButton
                        value="${msg['label.cancel']}"
                        actionListener="#{projectController.reload}"
                        icon="fa fa-chevron-circle-left"
                        update="mainContent"
                        process="@this"
                        onstart="start()" onsuccess="finish()">
                        <h:inputHidden value="${projectController.listId}" />
                        <f:param name="id" value="0"/>
                        <f:param name="force" value="true"/>
                        <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                    </p:commandButton>
                    
                    <!-- cac button an de thuc hien xu ly theo issue status -->
                    <p:commandLink id="cmdCustomerSupportMail"
                        actionListener="#{issueCustSupportController.create()}"
                        update=":panelCustomerSupportMail"
                        oncomplete="PF('dlgCustomerSupportMail').show();"
                        process="@this"
                        styleClass="hide"
                        onstart="start()" onsuccess="finish()">
                        <i class="fa fa-user-md"></i>
                        <h:outputLabel value="${issue['label.escalation_4']}" />
                    </p:commandLink>

                    <p:commandLink id="cmdSendSupportMail"
                        actionListener="#{issueSupportController.create('1')}"
                        oncomplete="PF('dlgSendSupportMail').show();"
                        update=":panelGridDialogMailSupport"
                        process="@this"
                        styleClass="hide"
                        onstart="start()" onsuccess="finish()">
                        <f:param name="issueId" value="${issueController.issue.issueId}" />
                    </p:commandLink>

                    <p:commandLink id="cmdSendComment"
                        actionListener="#{issueCommentController.create()}"
                        update=":panelSendComment"
                        oncomplete="PF('dlgCommentMail').show();"
                        process="@this"
                        styleClass="hide"
                        onstart="start()" onsuccess="finish()">
                        <h:outputLabel value="${issue['label.escalation_3']}" />
                    </p:commandLink>

                    <p:commandButton id="cmdSupport"
                        rendered="#{(sec.isMaster() or sec.hasMethod('IssueSupportController', 'REQUESTMAIL'))}"
                        actionListener="#{issueSupportController.create('2')}"
                        update=":inputTextRequestMailSubject, :inputTextareaRequestMailBody, :inputTextareaRequestMailFooter, :panel_to_d_o_users, :panel_cc_d_o_users, :panel_bcc_d_o_users"
                        oncomplete="PF('dlgSendRequestMail').show();"
                        process="@this" styleClass="hide"
                        onstart="start()" onsuccess="finish()">
                        <f:param name="issueId" value="${issueController.issue.issueId}" />
                    </p:commandButton>
                    <!-- cac button an -->
                
                    <p:commandButton
                        rendered="#{(sec.isMaster() or sec.hasMethod('IssueController', 'create'))}"
                        actionListener="#{issueController.insert(true)}"
                        action="#{issueController.outcome(issueController.lastIssuerInsertedId)}"
                        update="mainContent ,:growl" styleClass="btn-issue-insert hide"
                        onstart="start()" onsuccess="finish()">
                        <f:param name="id" value="#{issueController.lastIssuerInsertedId}"/>
                        <f:param name="force" value="true"/>
                    </p:commandButton>
                    <p:commandButton
                        onclick="doValidateAndSubmitIssue($('.btn-issue-insert'), '#{msg['javax.faces.component.UIInput.REQUIRED']}')"
                        rendered="#{(sec.isMaster() or sec.hasMethod('IssueController', 'create'))}"
                        value="${msg['label.insert']}"
                        icon="fa fa-check-circle" >
                    </p:commandButton>
                </div>
            </div>
        </f:facet>
    </h:panelGrid>
</ui:composition>
