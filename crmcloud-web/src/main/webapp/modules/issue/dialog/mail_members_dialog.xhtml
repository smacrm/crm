<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
    <p:panelGrid id="panelSendMailMembers" styleClass="panelSendMailMembers">
        <p:row>
            <p:column styleClass="value-cell" style="width: 210px !important;">
                <div class="dialog_header">
                    <p:outputLabel>#{msg['label.group.name']}</p:outputLabel>
                </div>
                <div class="group_container">
                    <p:tree value="#{issueSupportController.groupTree}" var="node" dynamic="true" 
                            selectionMode="single" style="width: 210px !important;">
                        <p:ajax event="select" update="pickMembers" listener="#{issueSupportController.onChangeGroup}"
                                onstart="$('#panelSendMailMembers #pickMembers').block({message: ''})"
                                onsuccess="$('#panelSendMailMembers #pickMembers').unblock()"/>
                        <p:treeNode>
                            <h:outputText value="#{node.groupName}" />
                        </p:treeNode>
                    </p:tree>
                </div>
            </p:column>
            <p:column>
                <p:pickList
                    id="pickMembers"
                    value="#{issueSupportController.members}"
                    var="members"
                    itemLabel="#{members.label}"
                    itemValue="#{members}"
                    immediate="true"
                    rendered="true"
                    converter="gnext.picklist.converter.selecitem">
                    <f:facet name="sourceCaption">#{mailBundle['label.mail.person.member']}</f:facet>
                    <f:facet name="targetCaption">#{mailBundle['label.mail.person.add']}</f:facet>
                    <p:ajax event="transfer" listener="#{issueSupportController.onTransferMember}"/>
                </p:pickList>
            </p:column>
        </p:row>
        <p:row>
            <p:column colspan="2" style="text-align: center !important;padding: 1.5em !important;">
                <p:commandButton
                    value="#{mailBundle['label.mail.person.decision']}"
                    actionListener="#{issueSupportController.updatePickList()}"
                    onstart="start()" onsuccess="finish()"
                    oncomplete="handleCloseDialog(xhr, status, args, 'dlgMailMembers');"
                    update=":panel_to_d_o_users, :panel_cc_d_o_users, :panel_bcc_d_o_users" />
            </p:column>
        </p:row>
        <h:outputScript>reBuildTree('group_container')</h:outputScript>
    </p:panelGrid>
</ui:composition>