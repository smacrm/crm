<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    
    <!-- 削除Dialog -->
    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="${msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="${msg['label.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
    </p:confirmDialog>
    
    <!-- 顧客対応ボタンを押す時の処理 -->
    <p:dialog
        header="#{issue['label.tab_todo_list']}"
        widgetVar="dlgCustomerTodo"
        modal="true"
        width="800"
        dynamic="true"
        responsive="true"
        draggable="false"
        resizable="false">
        <p:panelGrid id="panelGridCustomerTodo" style="width: 100%;" styleClass="panelGridDialogTodo">
            <p:row>
                <p:column styleClass="td_15">
                    <h:outputLabel value="${msg['label.plans.datetime']}" />
                    <font>*</font>
                </p:column>
                <p:column>
                    <p:calendar
                        label="${msg['label.plans.datetime']}"
                        title="${msg['label.plans.datetime']}"
                        locale="#{loginController.member.locale}"
                        value="#{issueTodoController.issueTodo.todoIntendedDatetime}"
                        pattern="yyyy/MM/dd HH:mm"
                        showOn="button"
                        styleClass="input_datetime">
                        <!--<f:validator validatorId="gnext.validator.RequiredValidator" />-->
                        <f:attribute name="title" value="#{msg['label.plans.datetime']}"/>
                    </p:calendar>
                </p:column>
            </p:row>
            <p:row>
                <p:column>
                    <h:outputLabel value="${msg['label.importance']}" />
                </p:column>
                <p:column>
                    <p:selectOneButton value="#{issueTodoController.issueTodo.todoImportantLevel}" converter="gnext.converter.smart">
                        <f:selectItems value="#{issueController.select.get('todo_importance_id')}"/>
                    </p:selectOneButton>
                </p:column>
            </p:row>
            <p:row>
                <p:column>
                    <h:outputLabel value="${issue['label.issue_todo_shared_department']}" />
                </p:column>
                <p:column>
                    <p:selectBooleanCheckbox value="${issueTodoController.issueTodo.todoShareFlag}" />
                </p:column>
            </p:row>
            <p:row>
                <p:column style="vertical-align: text-top">
                    <h:outputLabel value="${issue['label.todo_comment']}" />
                    <font>*</font>
                </p:column>
                <p:column>
                    <p:inputTextarea
                        rows="10" maxlength="2000"
                        autoResize="false" label="${issue['label.todo_comment']}"
                        value="${issueTodoController.issueTodo.todoContent}">
                        <f:attribute name="title" value="${issue['label.post']}"/>
                        <f:attribute name="title" value="#{issue['label.todo_comment']}"/>
                    </p:inputTextarea>
                </p:column>
            </p:row>
            <p:row>
                <p:column colspan="2" style="text-align: center !important;padding: 0.3em;">
                    <c:choose>
                        <c:when test="${!empty issueTodoController.issueTodo.todoId}">
                            <p:commandButton
                                actionListener="${issueTodoController.update()}"
                                icon="fa fa-edit"
                                value="${msg['label.update']}"
                                update=":tabViewIssue:panelGrid_todos, :tabViewIssue:tabViewTodoListTitle, :todoListGroup, panelGridCustomerTodo :growl"
                                process="@this:panelGridCustomerTodo"
                                oncomplete="handleCloseDialog(xhr, status, args, 'dlgCustomerTodo')"/>
                        </c:when>
                        <c:otherwise>
                            <p:commandButton
                                actionListener="${issueTodoController.insert()}"
                                icon="fa fa-save"
                                value="${msg['label.register']}"
                                update=":tabViewIssue:panelGrid_todos, :tabViewIssue:tabViewTodoListTitle, :todoListGroup, panelGridCustomerTodo :growl"
                                process="@this:panelGridCustomerTodo"
                                oncomplete="handleCloseDialog(xhr, status, args, 'dlgCustomerTodo')"/>
                        </c:otherwise>
                    </c:choose>
                </p:column>
            </p:row>
        </p:panelGrid>
    </p:dialog>
    
    <!-- 顧客へメールボタンを押す時の処理 -->
    <p:dialog
        id="dlgSendSupportMail"
        header="#{issue['label.mail_correspondence_customers']}"
        widgetVar="dlgSendSupportMail"
        modal="true"
        width="1000"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true"
        onShow="loadDivFileUploadClick('fileUploadSuportRigth');">
        <p:ajax event="close" oncomplete="try{callbackIssueCloseDialog('#{validator['validator.dialog.required']}')}catch(e){}"/>
        <ui:include src="/modules/issue/dialog/mail_support_dialog.xhtml" />
    </p:dialog>

    <!-- 返信メールリンクを押す時の処理 -->
    <p:dialog
        header="#{issue['label.escalation_1']}"
        widgetVar="dlgSendSupportReplyMail"
        modal="true"
        width="800"
        height="500"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true">
        <ui:include src="/modules/issue/dialog/mail_support_reply_dialog.xhtml" />
    </p:dialog>

    
    <!-- 依頼メールボタンを押す時の処理 -->
    <p:dialog
        id="dlgSendRequestMail"
        header="#{issue['label.escalation_2']}"
        widgetVar="dlgSendRequestMail"
        modal="true"
        width="800"
        height="620"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true">
        <p:ajax event="open" listener="#{issueController.loadUserGroupContext()}" update="panelSendRequestMail"/>
        <p:ajax
            event="close"
            onstart="dialogOncloseResetValFromParas(['to_d_o_users','cc_d_o_users','bcc_d_o_users']);"
            oncomplete="try{callbackIssueCloseDialog('#{validator['validator.dialog.required']}')}catch(e){}"
            listener="#{issueSupportController.onMailRequest(false)}" />
        <ui:include src="/modules/issue/dialog/mail_request_dialog.xhtml" />
    </p:dialog>
    
    <!-- コメント記入ボタンを押す時の処理 -->
    <p:dialog
        header="#{issue['label.escalation_3']}"
        widgetVar="dlgCommentMail"
        modal="true"
        width="800"
        height="620"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true"
        onShow="loadDivFileUploadClick('fileUploadContent');">
        <p:ajax event="close" oncomplete="try{callbackIssueCloseDialog('#{validator['validator.dialog.required']}')}catch(e){}"/>
        <ui:include src="/modules/issue/dialog/comment_dialog.xhtml" />
    </p:dialog>
    
    <!-- 顧客対応ボタンを押す時の処理 -->
    <p:dialog
        header="#{issue['label.escalation_4']}"
        widgetVar="dlgCustomerSupportMail"
        modal="true"
        width="800"
        height="620"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true"
        onShow="loadDivFileUploadClick('fileUploadCustSupport');">
        <p:ajax event="close" oncomplete="try{callbackIssueCloseDialog('#{validator['validator.dialog.required']}')}catch(e){}"/>
        <ui:include src="/modules/issue/dialog/customer_support_dialog.xhtml" />
    </p:dialog>
    
    <p:dialog
        id="dlgMailMembers"
        widgetVar="dlgMailMembers"
        width="700"
        height="480"
        modal="true"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true">
        <p:ajax event="open" listener="#{issueController.loadUserGroupContext()}" update="panelSendMailMembers"/>
        <ui:include src="/modules/issue/dialog/mail_members_dialog.xhtml"/>
    </p:dialog> 
    
    <p:dialog
        id="dlgRiskSensor"
        header="#{issue['label.issue_risk_sensor']}"
        widgetVar="dlgRiskSensor"
        width="800"
        height="480"
        modal="true"
        draggable="false"
        resizable="false"
        dynamic="true"
        responsive="true">
        <ui:include src="/modules/issue/dialog/risk_sensor_dialog.xhtml"/>
    </p:dialog>
</ui:composition>