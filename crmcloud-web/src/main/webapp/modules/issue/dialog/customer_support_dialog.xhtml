<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
<p:panelGrid id="panelCustomerSupportMail" styleClass="panelGridDialogMailSupport">
    <p:row>
        <p:column colspan="4" styleClass="td_center td_padding">
            <c:choose>
                <c:when test="${issueCustSupportController.escalation.escalationId > 0}">
                    <p:commandButton
                        onstart="start()" onsuccess="finish()"
                        actionListener="${issueCustSupportController.update()}"
                        icon="fa fa-send-o"
                        value="${msg['label.update']}"
                        update="@(.toggleablePanelEscalation), :growl"
                        process="@this:panelCustomerSupportMail"
                        oncomplete="handleCloseDialog(xhr, status, args, 'dlgCustomerSupportMail')">
                        <f:param name="issueId" value="${issueController.issue.issueId}" />
                    </p:commandButton>
                </c:when>
                <c:otherwise>
                    <p:commandButton
                        onstart="start()" onsuccess="finish()"
                        actionListener="${issueCustSupportController.save()}"
                        icon="fa fa-send-o"
                        value="${msg['label.register']}"
                        update="@(.toggleablePanelEscalation), :growl"
                        process="@this:panelCustomerSupportMail"
                        oncomplete="handleCloseDialog(xhr, status, args, 'dlgCustomerSupportMail')">
                        <f:param name="issueId" value="${issueController.issue.issueId}" />
                    </p:commandButton>
                </c:otherwise>
            </c:choose>
        </p:column>
    </p:row>

    <p:row>
        <p:column styleClass="td_15">
            <h:outputLabel value="#{issue['label.escalationSendDateName_4']}" />
            <font>*</font>
        </p:column>
        <p:column styleClass="td_35">
            <p:calendar
                locale="#{loginController.member.locale}"
                value="#{issueCustSupportController.custSupport.date}"
                label="#{issue['label.escalationSendDateName_4']}"
                pattern="yyyy/MM/dd HH:mm"
                showOn="button"
                styleClass="input_datetime" />
        </p:column>
        <p:column styleClass="td_15">
            <h:outputLabel value="#{issue['label.support_person']}" />
            <font>*</font>
        </p:column>
        <p:column>
            <h:inputHidden value="#{issueCustSupportController.custSupportCreateId}" id="issue_customer_support_person_id" />
            <p:commandButton id="issueCustomerSupportPersonList" type="button" icon="fa fa-th" styleClass="menu-toggle" />
            <label id="label_issue_customer_support_person_id" class="font_weight_normal" >#{issueCustSupportController.custSupportCreateName}</label>
            <p:tieredMenu
                overlay="true"
                trigger="issueCustomerSupportPersonList"
                widgetVar="widgetIssueCustomerSupportPersonList"
                my="left top"
                at="left bottom"
                model="#{issueCustSupportController.selects.get('issue_customer_support_person_id')}"
                styleClass="tieredMenu_issue_customer_support_person_id" 
                a:ref="#label_issue_customer_support_person_id"
                a:target="#issue_customer_support_person_id"/>
            
        </p:column>
    </p:row>
    <p:row>
        <p:column>
            <h:outputLabel value="#{issue['label.support_method']}" />
            <font>*</font>
        </p:column>
        <p:column>
            <p:selectOneMenu value="#{issueCustSupportController.custSupport.header}" converter="gnext.converter.smart">
                <f:selectItems value="#{issueCustSupportController.select.get('cust_support_method_id')}" />
            </p:selectOneMenu>
        </p:column>
        <p:column>
            <h:outputLabel value="#{issue['label.support_class']}" />
            <font>*</font>
        </p:column>
        <p:column>
            <p:selectOneMenu value="#{issueCustSupportController.custSupport.footer}" converter="gnext.converter.smart">
                <f:selectItems value="#{issueCustSupportController.select.get('cust_support_class_id')}" />
            </p:selectOneMenu>
        </p:column>
    </p:row>
    <p:row>
        <p:column colspan="4">
            <p:inputTextarea
                title="#{msg['label.support_comment']}"
                rows="21"
                autoResize="false"
                value="#{issueCustSupportController.custSupport.sendMail.message}">
<!--                <f:validator validatorId="gnext.validator.RequiredValidator" />
                <f:validator validatorId="gnext.validator.LengthValidator" />
                <f:attribute name="max" value="20000"/>
                <f:attribute name="title" value="#{msg['label.mail.comment']}"/>-->
            </p:inputTextarea>
        </p:column>
    </p:row>
    <p:row rendered="#{sec.isMaster() or sec.hasMethod('IssueCustSupportController', 'upload')}">
        <p:column colspan="4" styleClass="verticalAlignTop">
            <div class="flex flex_row">
                <div class="flex_1" style="width: 130px">
                    <p:fileUpload
                        onstart="start()" oncomplete="finish()"
                        auto="true"
                        label="#{msg['label.add.file']}"
                        fileUploadListener="#{issueCustSupportController.upload}"
                        id="fileUploadCustSupport"
                        process="@this"
                        mode="advanced"
                        dragDropSupport="true"
                        multiple="true"
                        update="panelDataTableCustomerSupportFileList, :growl"
                        sizeLimit="10000000"
                        allowTypes="/(\.|\/)(gif|jpe?g|png|zip|csv|xls|xlsx|pdf)$/"
                        styleClass="fileUploadContentBackground">
                        <small>#{msg['label.drop.in.here']}</small>
                    </p:fileUpload>
                </div>
                <div class="flex_1_1">
                    <p:panel id="panelDataTableCustomerSupportFileList" styleClass="panelDataTableEmailFileList">
                        <table class="table table-responsive table-bordered table-hover" id="table-attachments">
                            <thead>
                                <tr>
                                    <td>#</td>
                                    <td>#{msg['label.file.name']}</td>
                                    <td>#{msg['label.size']}</td>
                                </tr>
                            </thead>
                            <tbody>
                                <ui:repeat value="#{issueCustSupportController.custSupport.attachs}" var="file" varStatus="customerSupportIdx">
                                    <tr>
                                        <td>
                                            <p:commandLink
                                                onstart="start()" onsuccess="finish()"
                                                actionListener="#{issueCustSupportController.deleteFile}"
                                                update="panelDataTableCustomerSupportFileList"
                                                process="@this"
                                                disabled="#{!(sec.isMaster() or sec.hasMethod('IssueCustSupportController', 'DELETEFILE'))}"
                                                styleClass="btn btn-xs btn-default">
                                                <f:param name="idx" value="#{customerSupportIdx.index}" />
                                                <span class="fa fa-minus-circle"></span>
                                            </p:commandLink>
                                        </td>
                                        <td><h:outputLabel value="#{file.file.fileName}" /></td>
                                        <td><h:outputLabel value="#{file.sizeView}" /></td>
                                    </tr>
                                </ui:repeat>
                            </tbody>
                        </table>
                    </p:panel>
                </div>
            </div>
        </p:column>
    </p:row>
</p:panelGrid>
</ui:composition>