<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <style>
        .col-vertical-align-top td { vertical-align: top; }
        .col-vertical-align-top td:nth-child(1) { width: 70%; }
        table { width: 100%; }
        #issueBlockUI { height: 100vh; }
        .box { height: 100%; }
    </style>
    <h:form id="mailDetailsForm">
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1> メール <small>一覧</small> </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="リストに戻る" title="リストに戻る"
                                         icon="fa fa-backward"
                                         actionListener="#{mailController.gotoList()}"
                                         update="mainContent"
                                         onstart="start()" onsuccess="finish()">
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.delete']}" title="#{msg['label.delete']}"
                                         icon="fa fa-trash"
                                         actionListener="#{mailListController.delete}"
                                         update="mainContent"
                                         onstart="start()" onsuccess="finish()">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.confirm.delete']}" icon="ui-icon-alert" />
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box">
            <div class="box-body">
                <h:panelGrid styleClass="grid-wrapper col-vertical-align-top" columns="2" style="width: 99%; height: 100%;margin-left: 5px;margin-top: -5px;">
                    <f:facet name="header">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 72px;">
                                    <p:commandButton value="再読込" disabled="true" icon="fa fa-refresh"
                                                     actionListener="#{mailListController.onRefresh}"
                                                     update="mainContent" onstart="start()" onsuccess="finish()"/>
                                </td>
                                <td style="width: 152px;">
                                    <p:inputText value="#{mailListController.searchKey}" styleClass="txt-search-with-key"/>
                                </td>
                                <td style="width: 164px;">
                                    <p:commandButton value="検索" icon="fa fa-search " styleClass="txt-search-with-key-action"
                                                     actionListener="#{mailListController.searchWithKey}"
                                                     update="mainContent" onstart="start()" onsuccess="finish()"/>
                                    <p:commandButton value="メール分割" rendered="#{mailController.mailDataModel.hasExplode()}"
                                                     actionListener="#{mailListController.searchWithKey}"
                                                     update="mainContent" onstart="start()" onsuccess="finish()"/>
                                </td>
                                <td style="text-align: right">
                                    <table style="width: 100%">
                                        <tr>
                                            <td>
                                                <p:selectOneMenu effect="fade" onchange="PF('cofirmMoveToFolder').show();"
                                                                 value="#{mailListController.folderToChange}">
                                                    <p:ajax listener="#{mailListController.moveMailToFolder}">
                                                        <f:param name="actionMoveToFolder" value=""/>
                                                    </p:ajax>
                                                    <f:selectItem itemLabel="" itemValue="" />
                                                    <f:selectItems value="#{mailFolderController.allFolders}"
                                                                   var="folder"
                                                                   itemLabel="#{folder.displayFolderNameWithIcon}"
                                                                   itemValue="#{folder.folderCode}">
                                                    </f:selectItems>
                                                </p:selectOneMenu>
                                            </td>
                                            <td style="width: 15%;">
                                                <h:outputText value="#{mailController.paginator.to} / #{mailController.paginator.total}"/>
                                                <p:commandButton title="#{msg['label.previous']}"
                                                                 icon="fa fa-angle-left"
                                                                 styleClass="ui-corner-left"
                                                                 id="btnNext"
                                                                 disabled="#{mailController.paginator.first}"
                                                                 actionListener="#{mailController.previousPaging}"
                                                                 update="mainContent"
                                                                 onstart="start()" onsuccess="finish()">
                                                    <f:param name="page" value="details"/>
                                                </p:commandButton>
                                                <p:commandButton title="#{msg['label.next']}"
                                                                 icon="fa fa-angle-right"
                                                                 styleClass="ui-corner-right"
                                                                 id="btnPrevious"
                                                                 disabled="#{mailController.paginator.last}"
                                                                 actionListener="#{mailController.nextPaging}"
                                                                 update="mainContent"
                                                                 onstart="start()" onsuccess="finish()">
                                                    <f:param name="page" value="details"/>
                                                </p:commandButton>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </table>
                    </f:facet>
                    <p:column style="width: 70%;">
                        <p:outputPanel>
                            <table>
                                <tr>
                                    <td>
                                        <h:outputText value="From: " style="font-weight: bold;"/>
                                        <h:outputText value="#{mailController.mailDataModel.mailData.mailDataFrom}"/>
                                    </td>
                                    <td>
                                        <h:outputText value="To: " style="font-weight: bold;"/>
                                        <h:outputText value="#{mailController.mailDataModel.mailData.mailDataTo}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <p:outputLabel value="#{mailController.mailDataModel.mailData.mailDataSubject}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="2">
                                        <c:if test="#{not empty mailController.mailDataModel.attachments
                                                      and mailController.mailDataModel.attachments.size() > 0}">
                                            <c:forEach var="attachment" items="#{mailController.mailDataModel.attachments}">
                                                <i class="fa fa-file-archive-o" aria-hidden="true"></i>
                                                <p:commandLink ajax="false" value="#{attachment.attachmentName}"
                                                               style="margin-left: 5px;"
                                                               actionListener="#{downloadController.prepDownloadAttachment(attachment.attachmentId)}"> 
                                                    <p:fileDownload value="#{downloadController.fileDownload}" />
                                                </p:commandLink>
                                            </c:forEach>
                                        </c:if>
                                    </td>
                                </tr>
                            </table>
                            <hr style="margin-bottom: 10px;margin-top: 10px;"/>
                            <p:outputPanel style="overflow-y: auto;height: 400px;">
                                <h:outputText escape="false" value="#{mailController.mailDataModel.body}"/>
                            </p:outputPanel>
                        </p:outputPanel>
                    </p:column>
                    <p:column>
                        <div class="panel panel-default">
                            <div class="panel-heading">案件履歴</div>
                            <div class="panel-body" style="max-height: 67vh;overflow-y: auto;">
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                                キリン生ビールコールセンターから対応依頼です<br/>
                                ※対応依頼の送達確認のため、空メールを必ず返信してください<br/><br/>

                                受付番号　　：C1608300000000004<br/>
                                受付日時　　：2016/08/30 09:13<br/>
                                受付者　　　：システム　管理者<br/>
                                設置場所名称：設置場所名称<br/>
                                設置場所電話：0983925181<br/>
                                設置場所住所：〒0600000 北海道札幌市中央区新田３ー６ー１１<br/>
                                機種名称　　：にほん<br/>
                                備考　　　　：テスト　ノト<br/>
                                受付内容１　：ひあなひあなひあなひあなひあなひあなひあなひあなひあな<br/>
                                受付内容２　：<br/>
                                受付内容３　：<br/>
                                連絡事項　　：題名題名題名<br/>
                                題名題名題名<br/>
                            </div>
                        </div>
                    </p:column>
                </h:panelGrid>
            </div>
        </div>
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="#{msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
            <p:commandButton value="#{msg['label.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
        </p:confirmDialog>
        <p:confirmDialog message="会社情報を削除してよろしいでしょうか？" header="#{msg['label.delete']}"  widgetVar="cofirmMoveToFolder">  
            <p:commandButton value="#{msg['label.yes']}" onclick="PF('cofirmMoveToFolder').hide();" icon="ui-icon-check"
                             update="mainContent"
                             actionListener="#{mailListController.moveMailToFolder}">
                <f:param name="actionMoveToFolder" value="1"/>
            </p:commandButton>
            <p:commandButton value="#{msg['label.no']}" onclick="PF('cofirmMoveToFolder').hide();" icon="ui-icon-close"
                             update="mainContent"
                             actionListener="#{mailListController.moveMailToFolder}">
                <f:param name="actionMoveToFolder" value="0"/>
            </p:commandButton>
        </p:confirmDialog>
        <script type="text/javascript">
            jQuery(document).ready(function ($) {
                $( ".txt-search-with-key" ).keypress(function(event) {
                    if (event.which === 13) {
                        $(".txt-search-with-key-action").trigger('click');
                        event.preventDefault();
                    }
                });
            });
        </script>
    </h:form>
</ui:composition>