<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <style>
        .col-vertical-align-top td { vertical-align: top; }
        .col-vertical-align-top td:nth-child(1) { width: 300px; }
        .row-selected { background-color: #fca752 !important; }
        .ui-panel-titlebar { padding: 5px 10px !important; }
        .ui-datagrid-header { border-bottom: 1px solid #d5d5d5 !important; }
    </style>
    <div id="pageTitle">#{msg['label.menu.MailExplodeController']}</div>
    <h:form id="mailExplodeFrm" onkeypress="if (event.keyCode === 13 &amp;&amp; $(event.target).prop('tagName') !== 'TEXTAREA') { return false; }">
        <h:panelGrid width="100%" styleClass="page-header" id="pngHeader">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{mailBundle['label.mail.explode.header']} 
                            <small>#{mailBundle['label.mail.explode.header.list']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.create']}"
                                         title="#{msg['label.create']}"
                                         icon="fa fa-plus-circle"
                                         update="mainContent"
                                         actionListener="#{mailExplodeController.show}"
                                         rendered="#{mailExplodeController.showTipPage()}"
                                         onstart="start()" onsuccess="finish()">
                            <f:param name="showType" value="create"/>
                        </p:commandButton>

                        <p:commandButton value="#{msg['label.back']}"
                                         title="#{msg['label.back']}"
                                         icon="fa fa-chevron-circle-left"
                                         update="mainContent" process="@this"
                                         actionListener="#{mailExplodeController.init}"
                                         rendered="#{mailExplodeController.showBackButton()}"
                                         onstart="start()" onsuccess="finish()">
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.save']}"
                                         title="#{msg['label.save']}"
                                         icon="fa fa-check-circle"
                                         update="mainContent,:growl"
                                         actionListener="#{mailExplodeController.save}"
                                         rendered="#{mailExplodeController.showAddPage() and sec.hasMethod('MailExplodeController', 'create')}"
                                         onstart="start()" onsuccess="finish()">
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.edit']}"
                                         title="#{msg['label.edit']}"
                                         icon="fa fa-check-circle"
                                         update="mainContent,:growl"
                                         actionListener="#{mailExplodeController.update}"
                                         rendered="#{mailExplodeController.showEditPage() and sec.hasMethod('MailExplodeController', 'update')}"
                                         onstart="start()" onsuccess="finish()">
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box">
            <div class="box-body" style="overflow-y:auto;">
                <h:panelGrid styleClass="grid-wrapper col-vertical-align-top" columns="2" style="width: 100%;margin-top: -10px;">
                    <p:column>
                        <p:dataGrid var="row" columns="1" id="listFilters" value="#{mailExplodeController.models}" emptyMessage="#{msg['label.records.empty']}">
                            <f:facet name="header">
                                <p:outputLabel value="#{mailBundle['label.mail.explode.leftpanel.title']}"/>
                            </f:facet>
                            <p:column>
                                <table class="#{not empty mailExplodeController.activeMenu(row.mailExplode.mailExplodeId)?'row-selected':''} tblItemsExplode"
                                       style="margin-left: -3px;margin-right: -3px;margin-bottom: -3px; margin-top: -3px;cursor: pointer;">
                                    <tr style="border-bottom: 1px solid #d2d6de;">
                                        <td style="padding-top: 4px;padding-left: 10px;"
                                            class="#{row.mailExplode.mailExplodeId eq mailExplodeController.model.mailExplode.mailExplodeId?'itemactive':''}">
                                            <p:commandLink value="#{row.mailExplode.mailExplodeTitle}"
                                                           actionListener="#{mailExplodeController.show}"
                                                           rendered="#{sec.hasMethod('MailExplodeController', 'update')}"
                                                           style="font-weight: #{mailExplodeController.activeMenu(row.mailExplode.mailExplodeId)}"
                                                           process="@this" update="@form" onstart="start()" onsuccess="finish()">
                                                <f:param name="mailExplodeId" value="#{row.mailExplode.mailExplodeId}"/>
                                                <f:param name="showType" value="edit"/>
                                                <p:resetInput target="@form" />
                                            </p:commandLink>
                                        </td>
                                        <td>
                                            <div class="dropdown" style="float: right;">
                                                <button style="width: 25px; height: 25px;"
                                                        class="btn btn-default dropdown-toggle" type="button"
                                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                                                    <span class="caret" style="margin-left: -4px;margin-top: -9px;"></span>
                                                </button>
                                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.details']}"
                                                                       actionListener="#{mailExplodeController.show}"
                                                                       process="@this" update="@form"
                                                                       rendered="#{sec.hasMethod('MailExplodeController', 'update')}"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="mailExplodeId" value="#{row.mailExplode.mailExplodeId}"/>
                                                            <f:param name="showType" value="edit"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.copy']}"
                                                                       actionListener="#{mailExplodeController.copy}"
                                                                       process="@this" update="@form"
                                                                       rendered="#{sec.hasMethod('MailExplodeController', 'copy')}"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="mailExplodeId" value="#{row.mailExplode.mailExplodeId}"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.delete']}"
                                                                       actionListener="#{mailExplodeController.delete}"
                                                                       process="@this" update="@form,:growl"
                                                                       rendered="#{sec.hasMethod('MailExplodeController', 'delete')}"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="mailExplodeId" value="#{row.mailExplode.mailExplodeId}"/>
                                                            <p:confirm header="#{mailBundle['label.mail.explode.confirm.delete.header']}" message="#{mailBundle['label.mail.explode.confirm.delete.message']}" icon="ui-icon-alert" />
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.up']}"
                                                                       actionListener="#{mailExplodeController.up}"
                                                                       process="@this" update="@form"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="rowIndex" value="#{row.rowNum}"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.first']}"
                                                                       actionListener="#{mailExplodeController.first}"
                                                                       process="@this" update="@form"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="rowIndex" value="#{row.rowNum}"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.down']}"
                                                                       actionListener="#{mailExplodeController.down}"
                                                                       process="@this" update="@form"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="rowIndex" value="#{row.rowNum}"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                    <li>
                                                        <p:commandLink value="#{mailBundle['label.mail.explode.last']}"
                                                                       actionListener="#{mailExplodeController.last}"
                                                                       process="@this" update="@form"
                                                                       onstart="start()" onsuccess="finish()">
                                                            <f:param name="rowIndex" value="#{row.rowNum}"/>
                                                            <p:resetInput target="@form" />
                                                        </p:commandLink>
                                                    </li>
                                                </ul>
                                            </div> 
                                        </td>
                                    </tr>
                                </table>
                            </p:column>
                        </p:dataGrid>
                    </p:column>
                    <p:column>
                        <p:panel style="margin-bottom:20px" id="rightPanel">
                            <p:focus context="rightPanel"/>
                            <f:facet name="header">
                                <p:outputLabel value="#{mailBundle['label.mail.explode.rightpanel.title']}" style="text-align: left; width: 100%;"/>
                            </f:facet>

                            <h:panelGrid columns="1" cellpadding="10" style="width: 100%;"
                                         rendered="#{mailExplodeController.showTipPage()}">
                                <p:outputPanel>
                                    <h:outputText value="#{mailBundle['label.mail.explode.rightpanel.tipandtrick']}" escape="false" />
                                </p:outputPanel>
                            </h:panelGrid>

                            <h:panelGrid columns="1" cellpadding="10" style="width: 100%;" id="panelGridExplodeData"
                                         rendered="#{mailExplodeController.showBackButton()}">
                                <p:outputPanel>
                                    <h:panelGrid columns="2" style="width: 35%;">
                                        <p:outputLabel value="#{mailBundle['label.mail.explode.rightpanel.items.name']}" styleClass="required"/>
                                        <p:inputText value="#{mailExplodeController.model.mailExplode.mailExplodeTitle}" id="txtMailExplodeTitle" maxlength="256">
                                            <f:validator validatorId="gnext.validator.RequiredValidator" />
                                            <f:validator validatorId="gnext.validator.LengthValidator" />
                                            <f:attribute name="max" value="256"/>
                                            <f:attribute name="title" value="#{mailBundle['label.mail.explode.rightpanel.items.name']}"/>
                                        </p:inputText>
                                    </h:panelGrid>
                                    <h:outputText value="#{mailBundle['label.mail.explode.rightpanel.tipandtrick_2']}" escape="false" />
                                </p:outputPanel>
                                <p style="height: 5px;"></p>
                                <p:dataTable id="explodeItems" var="row"
                                             value="#{mailExplodeController.model.explodeItems}">
                                    <p:column headerText="#{mailBundle['label.mail.explode.rightpanel.items.firstchar']}">
                                        <p:inputText value="#{row.firstChar}" style="width: 100%;" maxlength="20">
                                            <f:validator validatorId="gnext.validator.RequiredValidator" />
                                            <f:validator validatorId="gnext.validator.LengthValidator" />
                                            <f:attribute name="max" value="20"/>
                                            <f:attribute name="title" value="#{mailBundle['label.mail.explode.rightpanel.items.firstchar']}"/>
                                        </p:inputText>
                                    </p:column>
                                    <p:column headerText="#{mailBundle['label.mail.explode.rightpanel.items.secondchar']}">
                                        <p:inputText value="#{row.secondChar}" style="width: 100%;" id="txtMailExplodeCondition" maxlength="20">
                                            <f:validator validatorId="gnext.validator.RequiredValidator" />
                                            <f:validator validatorId="gnext.validator.LengthValidator" />
                                            <f:attribute name="max" value="20"/>
                                            <f:attribute name="title" value="#{mailBundle['label.mail.explode.rightpanel.items.secondchar']}"/>
                                        </p:inputText>
                                    </p:column>
                                    <p:column headerText="#{mailBundle['label.mail.explode.rightpanel.items.field']}">
                                        <p:selectOneMenu value="#{row.fieldExplode}" style="width: 100%;" height="200" filter="true" filterMatchMode="startsWith">
                                            <f:selectItems value="#{mailExplodeController.fieldExplodes}" />
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column headerText="#{mailBundle['label.mail.explode.rightpanel.items.trimspace']}" styleClass="text-center" width="70px;">
                                        <p:selectBooleanCheckbox value="#{row.trimSpace}"/>
                                    </p:column>
                                    <p:column style="width:70px" styleClass="table-action">
                                        <p:commandLink
                                            styleClass="btn btn-xs btn-default"
                                            update="mailExplodeFrm:explodeItems,:growl"
                                            actionListener="#{mailExplodeController.addItem}"
                                            process="@form"
                                            onstart="start()" onsuccess="finish()">
                                            <span class="fa fa-plus-circle"></span>
                                        </p:commandLink>
                                        <p:commandLink 
                                            styleClass="btn btn-xs btn-default"
                                            update="mailExplodeFrm:rightPanel"
                                            actionListener="#{mailExplodeController.removeItem(row.id)}"
                                            process="@this"
                                            onstart="start()" onsuccess="finish()">
                                            <span class="fa fa-minus-circle"></span>
                                        </p:commandLink>
                                    </p:column>
                                </p:dataTable>
                            </h:panelGrid>

                        </p:panel>
                    </p:column>
                </h:panelGrid>
            </div>
        </div>
        <h:outputScript>
            jQuery(document).ready(function ($) {
                // https://stackoverflow.com/questions/7632125/trigger-a-click-event-on-an-inner-element
                $(".tblItemsExplode tr td:first-child").click(function(e) {
                    var $link = $(this).find("a");
                    if (e.target === $link[0]) {
                        return false;
                    }
                    $link.trigger('click');
                    return false;
                });
            });
        </h:outputScript>
    </h:form>
    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="${msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="${msg['label.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
    </p:confirmDialog>
</ui:composition>