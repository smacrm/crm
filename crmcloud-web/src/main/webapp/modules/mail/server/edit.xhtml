<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <div id="pageTitle">#{mailBundle['label.mail.server.information.title']} #{msg['symbol.paren.left']}#{mailBundle['label.mail.server.title.edit']}#{msg['symbol.paren.right']}</div>
    <h:form id="frmMailServer">
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{mailBundle['label.mail.server.title']}
                            <small>#{msg['label.edit']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.back']}" icon="fa fa-chevron-circle-left"
                                         actionListener="#{mailServerController.load}"
                                         title="#{msg['label.back']}" update="mainContent" process="@this"
                                         onstart="start()" onsuccess="finish()">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.update']}" icon="fa fa-check-circle"
                                         actionListener="#{mailServerController.update}"
                                         rendered="${sec.hasMethod('MailServerController', 'update')}"
                                         title="#{msg['label.update']}"
                                         update="frmMailServer,mainContent,:growl"
                                         onstart="start()" onsuccess="finish()">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box">
            <div class="box-body">
                <p:panelGrid id="pgMailServer" styleClass="crmcloud-panelgrid">
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.name']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{mailServerController.model.mailServer.serverName}"
                                         styleClass="input_text" id="j_server_name" autocomplete="off" maxlength="100">
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.name']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>

                    <!-- POP3/IMAP -->
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.type']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:selectOneRadio value="#{mailServerController.model.mailServer.serverType}"
                                              layout="grid" columns="2" style="width: 12%;"
                                              valueChangeListener="#{mailServerController.onChangeServerType}">
                                <f:selectItem itemLabel="POP3" itemValue="POP3" />
                                <f:selectItem itemLabel="IMAP" itemValue="IMAP" />
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.type']}"/>

                                <p:ajax update="serverPort,toolTipServerPost" />
                            </p:selectOneRadio>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.host']}" styleClass="required"/>
                        </p:column>
                        <p:column style="width: 375px;">
                            <p:inputText value="#{mailServerController.model.mailServer.serverHost}"
                                         styleClass="input_text" autocomplete="off" maxlength="100">
                                <p:keyFilter regEx="/[a-zA-Z0-9_\-\.]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:validator validatorId="gnext.validator.DomainIpValidator" />
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.host']}"/>
                                <f:attribute name="testConnection" value="true"/>
                            </p:inputText>
                        </p:column>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.port']}" styleClass="required"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{mailServerController.model.mailServer.serverPort}"
                                         styleClass="input_text" id="serverPort" autocomplete="off" maxlength="8"
                                         converterMessage="#{validator['validator.mail.port.converter.invalid']}">
                                <p:keyFilter regEx="/[0-9]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.NumberValidator" />
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.port']}"/>
                            </p:inputText>
                            <p:tooltip for="serverPort" trackMouse="true" id="toolTipServerPost"
                                       value="#{mailBundle['label.mail.server.tooltip.serverPort']}"/>
                        </p:column>
                    </p:row>

                    <!-- SMTP -->
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.smtp.host']}" styleClass="required"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{mailServerController.model.mailServer.serverSmtp}"
                                         styleClass="input_text" autocomplete="off" maxlength="100">
                                <p:keyFilter regEx="/[a-zA-Z0-9_\-\.]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:validator validatorId="gnext.validator.DomainIpValidator" />
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.smtp.host']}"/>
                                <f:attribute name="testConnection" value="true"/>
                            </p:inputText>
                        </p:column>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{mailBundle['label.mail.server.smtp.port']}" styleClass="required"/>
                        </p:column>
                        <p:column>
                            <p:inputText value="#{mailServerController.model.mailServer.serverSmtpPort}"
                                         styleClass="input_text" autocomplete="off" maxlength="8"
                                         converterMessage="#{validator['validator.mail.stmpport.converter.invalid']}">
                                <p:keyFilter regEx="/[0-9]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.NumberValidator" />
                                <f:attribute name="title" value="#{mailBundle['label.mail.server.smtp.port']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{mailBundle['label.mail.server.smtp.auth']}"/></p:column>
                        <p:column colspan="3">
                            <p:selectBooleanCheckbox value="#{mailServerController.model.serverAuth}"/>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{mailBundle['label.mail.server.ssl']}"/></p:column>
                        <p:column colspan="3">
                            <p:selectBooleanCheckbox value="#{mailServerController.model.serverSsl}"/>
                        </p:column>
                    </p:row>
                    
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value ="#{msg['label.state']}"/>
                        </p:column>
                        <p:column style="width: 375px;" styleClass="inputSwitch">
                            <p:inputSwitch value="#{mailServerController.model.mailServer.serverDeleted}" style="width: 80px" onLabel="#{msg['label.state.using']}" offLabel="#{msg['label.state.deleted']}" converter="gnext.inputSwitch.converter.numberToBooleanConverter"/>
                        </p:column>
                    </p:row>

                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.memo']}"/></p:column>
                        <p:column colspan="3">
                            <p:inputTextarea value="#{mailServerController.model.mailServer.serverMemo}"
                                             styleClass="input_memo" maxlength="500">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="title" value="#{msg['label.memo']}"/>
                                <f:attribute name="max" value="500"/>
                            </p:inputTextarea>
                        </p:column>
                    </p:row>
                </p:panelGrid></div></div>
    </h:form>
</ui:composition>
