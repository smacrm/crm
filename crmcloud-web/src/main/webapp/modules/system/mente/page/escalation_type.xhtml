<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
<h:form>
<p:panelGrid id="panelEscalationSample" styleClass="panelEscalationSample" columns="2">
    <c:choose>
<c:when test="${maintenanceController.currentStaticParent == 'project_pass_days'}">
    <p:column style="margin: 0;padding: 0 !important;border: none;" colspan="2">
        <c:set var="rowsPerPageTemplate" value="#{configController.getConfig('DATATABLE_ROW_PER_PAGE')}" scope="session" />
        <c:set var="rows" value="#{configController.getConfig('DATATABLE_DEFAULT_PER_PAGE')}" scope="session" />
        <p:dataTable id="dataTableIssueLamps" rowIndexVar="rowIndex"
                     var="issueLamp" value="#{issueLampController.issueLamps}"
                     scrollable="false" editable="true" styleClass="dataTableProjectPassDays"
                     lazy="true" paginator="true" paginatorTemplate="#{layout.paginatorTemplate}" currentPageReportTemplate="#{layout.currentPageReportTemplate}"
                     rowsPerPageTemplate="#{rowsPerPageTemplate}" rows="#{rows}" pageLinks="5" rowHover="true" emptyMessage="#{msg['label.data.empty']}">
            <p:ajax event="rowEdit" listener="#{issueLampController.onRowEdit}" update=":issueLamp, @this:dataTableIssueLamps, :growl" onstart="start()" onsuccess="finish()"/>
            <p:ajax event="rowEditCancel" listener="#{issueLampController.onRowCancel}" update=":issueLamp, @this:dataTableIssueLamps, :growl" onstart="start()" onsuccess="finish()"/>
            <p:column headerText="#{msg['label.name']}" style="text-align: left;width: 250px;" >                
                <p:cellEditor>
                    <f:facet name="output"><h:outputText value="#{issueLamp.itemName}"/></f:facet>
                    <f:facet name="input"><p:inputText value="#{issueLamp.itemName}" /></f:facet>
                </p:cellEditor>
            </p:column>
            <p:column headerText="#{issue['label.issue_proposal_name_1']}" style="padding: 0;border: none;" >                
                <p:dataList id="dataListLampsItemList" value="#{issueLamp.lampsItemList}" var="lampData" rowIndexVar="index" class="panel_mente_lamp_box">
                    <p:cellEditor>
                        <f:facet name="output">
                            <div class="panel_mente_lamp_view">
                                <span>#{lampData.viewLabel}</span>
                                <span>#{lampData.viewValue}</span>
                            </div>
                        </f:facet>
                        <f:facet name="input">
                            <div class="panel_mente_lamp">
                                <table>
                                    <tr>
                                        <td style="border: none;width: 125px;padding: 0;">
                                <p:selectOneMenu value="#{lampData.label}"
                                    style="width: 125px;"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{issueLampController.availableColumns}"
                                        var="item"
                                        itemLabel="#{item.name}" itemValue="#{item.id}"
                                        itemDisabled="#{(item.name.startsWith('---') || item.name.startsWith(' ---'))}" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax
                                        event="change" update="@this:dataListLampsItemList"
                                        listener="#{issueLampController.onChangeLampsItemList}"
                                        onstart="start()" onsuccess="finish()" />
                                </p:selectOneMenu>
                                        </td>
                                        <td style="border: none;">
                                <p:selectOneMenu rendered="#{lampData.type eq 7
                                    and ((lampData.label.contains('issue_proposal_'))
                                    or (lampData.label.contains('issue_product_')))
                                    or ((lampData.dynamicKey.contains('issue_proposal_'))
                                    or (lampData.dynamicKey.contains('issue_product_')))}"
                                    value="#{lampData.level}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItem itemLabel="#{issue['label.large']}" itemValue="1" />
                                    <f:selectItem itemLabel="#{issue['label.medium']}" itemValue="2" />
                                    <f:selectItem itemLabel="#{issue['label.small']}" itemValue="3" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax event="change" listener="#{issueLampController.onLevelChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>

                                <p:selectOneMenu rendered="#{(lampData.type eq 7 or lampData.type eq 8 or lampData.type eq 9)
                                    and (lampData.label.contains('dynamic_'))
                                    and (!lampData.label.contains('issue_proposal_'))
                                    and (!lampData.label.contains('issue_product_'))
                                    and (!lampData.dynamicKey.contains('issue_proposal_'))
                                    and (!lampData.dynamicKey.contains('issue_product_'))
                                    and (!lampData.dynamicKey.contains('issue_'))
                                    and (!lampData.dynamicKey.contains('cust_'))
                                    and (lampData.dynamicKey ne 'd_o_group')
                                    and (lampData.dynamicKey ne 'd_o_user')
                                    or (lampData.type eq 7 and lampData.label.contains('cust_status'))}"
                                    value="#{lampData.value}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{lampData.itemMenteList}"
                                        var="mente"
                                        itemLabel="#{mente.itemName}" itemValue="#{mente.itemId}" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax event="change" listener="#{issueLampController.onSelfChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>
                                <p:selectOneMenu rendered="#{lampData.type eq 7
                                    and (!(lampData.label.contains('dynamic_'))
                                    and lampData.label ne 'cust_city'
                                    and lampData.label ne 'cust_status'
                                    and lampData.label ne 'issue_receive_person_group_name'
                                    and lampData.label ne 'issue_authorizer_name'
                                    and lampData.label ne 'issue_receive_person_name'
                                    and lampData.label ne 'issue_creator_name'
                                    and lampData.label ne 'issue_updated_name')
                                    or ((lampData.label.contains('dynamic_'))
                                    and ((lampData.dynamicKey.contains('issue_'))
                                    or (lampData.dynamicKey.contains('cust_'))))}"
                                    value="#{lampData.value}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{lampData.itemMenteList}"
                                        var="mente"
                                        itemLabel="#{mente.getItemViewTreeName(maintenanceController.locale)}" itemValue="#{mente.itemId}" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax event="change" listener="#{issueLampController.onSelfChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>
                                <p:selectOneMenu rendered="#{lampData.type eq 7
                                    and (!(lampData.label.contains('dynamic_'))
                                    and (lampData.label eq 'issue_authorizer_name'
                                    or lampData.label eq 'issue_receive_person_name'
                                    or lampData.label eq 'issue_creator_name'
                                    or lampData.label eq 'issue_updated_name'))
                                    or ((lampData.label.contains('dynamic_')) and (lampData.dynamicKey eq 'd_o_user'))}"
                                    value="#{lampData.value}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{issueLampController.allMemberList}"
                                        var="member"
                                        itemLabel="#{member.memberNameFirst} #{member.memberNameLast}" itemValue="#{member.memberId}" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax event="change" listener="#{issueLampController.onSelfChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>
                                <p:selectOneMenu rendered="#{lampData.type eq 7 
                                    and (lampData.label eq 'issue_receive_person_group_name')
                                    or ((lampData.label.contains('dynamic_')) and (lampData.dynamicKey eq 'd_o_group'))}"
                                    value="#{lampData.value}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{issueLampController.allGroupList}"
                                        var="group"
                                        itemLabel="#{group.groupName}" itemValue="#{group.groupId}" />
                                    <p:ajax event="change" listener="#{issueLampController.onSelfChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>
                                <p:selectOneMenu rendered="#{lampData.type eq 7 and lampData.label eq 'cust_city'}"
                                    value="#{lampData.value}"
                                    filter="true" filterMatchMode="startsWith">
                                    <f:selectItems
                                        value="#{issueController.prefectures}"
                                        var="city"
                                        itemLabel="#{city.prefectureName}" itemValue="#{city.prefectureId}" />
                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                    <f:param name="lampDataIdx" value="#{index}" />
                                    <p:ajax event="change" listener="#{issueLampController.onSelfChange}" update="@this:dataListLampsItemList" />
                                </p:selectOneMenu>

                                <p:panel id="panelLampDate" rendered="#{lampData.type eq 6}" styleClass="panel_mente_period_lamp">
                                    <table>
                                        <tr>
                                            <td style="width: 30% !important;white-space: nowrap;border: none;">
                                                <div>
                                                    <h:outputLabel value="${msg['label.from']}" style="padding-left: 0.3em;padding-right: 0.3em" />
                                    <p:calendar
                                        disabled="#{lampData.isSearchPeriod}"
                                        locale="#{loginController.member.locale}"
                                        converter="gnext.converter.StringToDateConverter"
                                        value="#{lampData.value}"
                                        pattern="yyyy/MM/dd"
                                        showOn="button"
                                        navigator="true"
                                        styleClass="input_datetime">
                                        <f:param name="value" value="0" />
                                        <f:param name="lampIdx" value="#{rowIndex}" />
                                        <f:param name="lampDataIdx" value="#{index}" />
                                        <p:ajax event="dateSelect" listener="#{issueLampController.onDateViewChange}" update="@this:panelLampDate" />
                                    </p:calendar>
                                                </div>
                                                <div>
                                                    <h:outputLabel value="${msg['label.to']}" style="padding-left: 0.3em;padding-right: 0.3em" />
                                    <p:calendar
                                        disabled="#{lampData.isSearchPeriod}"
                                        locale="#{loginController.member.locale}"
                                        converter="gnext.converter.StringToDateConverter"
                                        value="#{lampData.valueTo}"
                                        pattern="yyyy/MM/dd"
                                        showOn="button"
                                        navigator="true"
                                        styleClass="input_datetime">
                                        <f:param name="value" value="1" />
                                        <f:param name="lampIdx" value="#{rowIndex}" />
                                        <f:param name="lampDataIdx" value="#{index}" />
                                        <p:ajax event="dateSelect" listener="#{issueLampController.onDateViewChange}" update="@this:panelLampDate" />
                                    </p:calendar>
                                                </div>
                                            </td>
                                            <td style="border: none;text-align: right;width: 20%;">
                                    <table>
                                        <tr>
                                            <td style="border: none;padding-left: 1em;padding-right: 0.3em;">
                                               <p:selectBooleanCheckbox value="#{lampData.isSearchPeriod}" >
                                                    <f:param name="lampIdx" value="#{rowIndex}" />
                                                    <f:param name="lampDataIdx" value="#{index}" />
                                                   <p:ajax update="@this:panelLampDate" listener="#{issueLampController.lampChangeSearchPeriod}" />
                                               </p:selectBooleanCheckbox>
                                               <h:outputLabel value="#{issue['label.issue_search_from_now']}" style="font-size: 12px;padding-left:0.2em;padding-rigth:0.2em;"/>
                                                <p:inputText
                                                    id="lampDatePeriodId"
                                                    disabled="#{lampData.isSearchPeriod==null || !lampData.isSearchPeriod}"
                                                    value="#{lampData.lampDateSearchPeriod}"
                                                    style="width: 2.5em !important;">
                                                    <p:ajax event="blur" update="@this:panelLampDate" />
                                                </p:inputText>
                                                <p:slider
                                                    disabled="#{lampData.isSearchPeriod==null || !lampData.isSearchPeriod}"
                                                    for="lampDatePeriodId" maxValue="36" />
                                            </td>
                                        </tr>
                                    </table>
                                            </td>
                                            <td style="vertical-align: top;border: none;">
                                                <p:selectOneButton
                                                    disabled="#{lampData.isSearchPeriod==null || !lampData.isSearchPeriod}"
                                                    value="#{lampData.lampDatePeriodBeforeAfter}"
                                                    style="border-left: 0 !important;display: inline-grid;">
                                                    <f:selectItem itemLabel="#{issue['label.issue_search_months_ago']}" itemValue="false" />
                                                    <f:selectItem itemLabel="#{issue['label.issue_search_months_later']}" itemValue="true" />
                                                </p:selectOneButton>
                                            </td>
                                        </tr>
                                    </table>
                                </p:panel>
                                <p:inputText rendered="#{lampData.type ne 6 and lampData.type ne 7 and lampData.type ne 8 and lampData.type ne 9}"
                                    value="#{lampData.value}">
                                    <p:ajax event="blur" update="@this:dataListLampsItemList" />
<!--                                    <f:validator validatorId="gnext.validator.RequiredValidator" />
                                    <f:validator validatorId="gnext.validator.LengthValidator" />
                                    <f:attribute name="max" value="100"/>
                                    <f:attribute name="title" value="#{lampData.viewLabel}"/>-->
                                </p:inputText>
                                        </td>
                                        <td  style="border: none;width: 2.5em;">
                                <p:commandLink 
                                    style="vertical-align:  top;"
                                    rendered="#{index == 0}"
                                    actionListener="#{issueLampController.addLampsItemList(issueLamp)}"
                                    update="@this:dataListLampsItemList" process="@this"
                                    onstart="start()" onsuccess="finish()"
                                    disabled="#{issueLamp.lampsItemList.size() gt 4}"
                                    styleClass="btn btn-xs btn-default bt_margin_top_03">
                                    <span class="fa fa-plus-circle"></span>
                                </p:commandLink>
                                <p:commandLink
                                    style="vertical-align:  top;"
                                    rendered="#{index > 0}"
                                    actionListener="#{issueLampController.deleteLampsItemList(issueLamp, lampData)}"
                                    update="@this:dataListLampsItemList" process="@this"
                                    onstart="start()" onsuccess="finish()"
                                    styleClass="btn btn-xs btn-default bt_margin_top_03">
                                    <span class="fa fa-minus-circle"></span>
                                </p:commandLink>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </f:facet>
                    </p:cellEditor>
                </p:dataList>
            </p:column>
            <p:column headerText="条件" style="text-align: center;width: 120px;">       
                <p:cellEditor>
                    <f:facet name="output"><h:outputText value="#{issueLamp.lampProposalName}" /></f:facet>
                    <f:facet name="input">
                        <p:selectOneMenu value="#{issueLamp.lampProposalId}">
                            <f:selectItem itemLabel="#{msg['label.condition.and']}" itemValue="1" />
                            <f:selectItem itemLabel="#{msg['label.condition.or']}" itemValue="2" />
                        </p:selectOneMenu>
                    </f:facet>
                </p:cellEditor>
            </p:column>
            <p:column headerText="#{msg['label.background']}#{msg['label.color']}" style="width: 5em;text-align: center;background-color: ##{issueLamp.lampColor}">
                <p:cellEditor>
                    <f:facet name="output">
                        <h:outputText value="#{issueLamp.lampColor}" />
                    </f:facet>
                    <f:facet name="input" id="color_input">
                        <p:colorPicker value="#{issueLamp.lampColor}" />
                    </f:facet>
                </p:cellEditor>
            </p:column>
            <p:column headerText="#{msg['label.text']}#{msg['label.color']}" style="width: 7em;text-align: center;background-color: ##{issueLamp.lampTextColor}">       
                <p:cellEditor>
                    <f:facet name="output">
                        <h:outputText value="#{issueLamp.lampTextColor}" />
                    </f:facet>
                    <f:facet name="input" id="color_input">
                        <p:colorPicker value="#{issueLamp.lampTextColor}" />
                    </f:facet>
                </p:cellEditor>
            </p:column>
            <p:column headerText="Action" style="width: 6em;text-align: center;"> 
                <f:facet name="header">
                    <p:commandLink
                        onstart="start()" onsuccess="finish()"
                        process="@form"
                        styleClass="btn btn-xs btn-default" 
                        actionListener="#{issueLampController.addStaticRow}"
                        update="@this:dataTableIssueLamps"
                        rendered="#{sec.hasMethod('MaintenanceController', 'create')}">
                        <span class="fa fa-plus-circle"></span>
                    </p:commandLink>
                </f:facet>
                <p:rowEditor styleClass="ui-row-editor ui-helper-clearfix text-center editable" style="display: inline-flex" rendered="#{sec.hasMethod('MaintenanceController', 'update')}"/>
                <p:commandLink
                    styleClass="ui-icon ui-icon-trash"
                    onstart="start()" onsuccess="finish()"
                    style="display: inline-flex"
                    actionListener="#{issueLampController.delete(issueLamp)}"
                    rendered="#{sec.hasMethod('MaintenanceController', 'delete')}"
                    update=":issueLamp, @this:dataTableIssueLamps, :growl">
                    <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.confirm.delete']}" icon="ui-icon-alert" />
                </p:commandLink>
            </p:column>
        </p:dataTable>
    </p:column>
</c:when>
<c:otherwise>
    <c:if test="${maintenanceController.currentStaticParent != 'mail_signature_id'}">
        <p:column>
            <h:outputLabel value="#{msg['label.mail.subject']}" />
            <font>*</font>
        </p:column>
        <p:column>
            <p:inputText
                value="#{maintenanceController.escalationSample.sampleSubject}"
                styleClass="input_text text_align_left" style="width: 50% !important;"
                label="#{msg['label.mail.subject']}" maxlength="100">
                <!--<f:validator validatorId="gnext.validator.RequiredValidator" />-->
                <f:validator validatorId="gnext.validator.LengthValidator" />
                <f:attribute name="max" value="100"/>
                <f:attribute name="title" value="#{msg['label.mail.subject']}"/>
            </p:inputText>
        </p:column>
    </c:if>

    <c:if test="${maintenanceController.currentStaticParent == 'cust_support_method_id'}">
        <p:column>
            <h:outputLabel value="#{mailBundle['label.mail.header']}" />
        </p:column>
        <p:column styleClass="td_not_padding">
            <p:inputTextarea
                rows="3"
                autoResize="false"
                maxlength="300"
                value="#{maintenanceController.escalationSample.sampleHeader}" />
        </p:column>
    </c:if>
    <p:column>
        <h:outputLabel value="#{msg['label.mail.comment']}" />
        <font>*</font>
    </p:column>
    <p:column styleClass="td_not_padding">
        <p:inputTextarea
            id="inputTextareaSupportMailBody"
            rows="25"
            autoResize="false"
            value="#{maintenanceController.escalationSample.sampleBody}"
            styleClass="inputTextareaSendMailComment text_align_left" maxlength="20000">
            <f:validator validatorId="gnext.validator.LengthValidator" />
            <f:attribute name="max" value="20000"/>
            <f:attribute name="title" value="#{msg['label.mail.comment']}" />
        </p:inputTextarea>
    </p:column>

    <c:if test="${maintenanceController.currentStaticParent != 'mail_signature_id'}">
        <p:column>
            <h:outputLabel value="#{mailBundle['label.mail.footer']}" />
        </p:column>
        <p:column styleClass="td_not_padding">
            <p:inputTextarea
                rows="7"
                autoResize="false"
                value="#{maintenanceController.escalationSample.sampleFotter}"
                styleClass="text_align_left" maxlength="500">
                <f:validator validatorId="gnext.validator.LengthValidator" />
                <f:attribute name="max" value="500"/>
                <f:attribute name="title" value="#{mailBundle['label.mail.footer']}}"/>
            </p:inputTextarea>
        </p:column>
    </c:if>
</c:otherwise>
    </c:choose>
</p:panelGrid>
</h:form>
<script type="text/javascript">
    //<![CDATA[
    function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode;
        if (charCode < 48 || charCode > 57)
            return false;
        return true;
    }
    //]]>
</script>
</ui:composition>
