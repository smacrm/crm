<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <div id="pageTitle">#{quartzBundle['label.batch.header']} #{msg['symbol.paren.left']}#{quartzBundle['label.batch.header.edit']}#{msg['symbol.paren.right']}</div>
    <h:form id="frmMailServer">
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <div class="row">
                    <div class="col-md-6">
                        <h1> #{quartzBundle['label.batch.header']} <small>#{quartzBundle['label.batch.header.edit']}</small> </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton value="#{msg['label.back']}" icon="fa fa-chevron-circle-left" title="#{msg['label.back']}" 
                                         actionListener="#{batchController.load}" process="@this" update="mainContent"
                                         onstart="start()" onsuccess="finish()">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.update']}" icon="fa fa-check-circle" title="#{msg['label.update']}"
                                         actionListener="#{batchController.update}"
                                         rendered="#{sec.hasMethod('BatchController','update')}"
                                         update="mainContent :growl"
                                         onstart="start()" onsuccess="finish()">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                    </div>
                </div>
            </f:facet>
        </h:panelGrid>
        <div class="box">
            <div class="box-body">
                <p:panelGrid id="pgBatch" styleClass="crmcloud-panelgrid">
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{quartzBundle['label.batch.name']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{batchController.batch.batchName}" styleClass="input_text" maxlength="100">
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:attribute name="title" value="#{quartzBundle['label.batch.name']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{quartzBundle['label.batch.group']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{batchController.batch.batchGroup}" styleClass="input_text" maxlength="100">
                                <p:keyFilter regEx="/[a-zA-Z0-9_\-]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:attribute name="title" value="#{quartzBundle['label.batch.group']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{quartzBundle['label.batch.command']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:selectOneMenu value="#{batchController.batch.batchCommand}" filter="true" filterMatchMode="startsWith">
                                <f:selectItems value="#{batchController.commands}" var="c" itemValue="#{c.commandId}" itemLabel="#{c.commandName}"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{quartzBundle['label.batch.cron']}" styleClass="required"/>
                        </p:column>
                        <p:column colspan="3">
                            <div id='selector'></div>
                            <p:inputText value="#{batchController.batch.batchCronJson}" styleClass="input_text" type="hidden" id="cron" maxlength="100">
                                <f:validator validatorId="gnext.validator.RequiredValidator" />
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="100"/>
                                <f:attribute name="title" value="Cron"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field">
                            <p:outputLabel value="#{quartzBundle['label.batch.autostart']}"/>
                        </p:column>
                        <p:column colspan="3">
                            <p:selectBooleanCheckbox value="#{batchController.batch.booleanBatchFlag}" />
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column styleClass="label-field"><p:outputLabel value="#{msg['label.memo']}"/></p:column>
                        <p:column colspan="3">
                            <p:inputTextarea value="#{batchController.batch.batchMemo}" styleClass="input_memo" maxlength="500">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="500"/>
                                <f:attribute name="title" value="#{msg['label.memo']}"/>
                            </p:inputTextarea>
                        </p:column>
                    </p:row>
                </p:panelGrid>
            </div>
        </div>
    </h:form>
    <script>
        $(document).ready(function () {
            $('#selector').cron({
                initCron: jQuery.parseJSON('#{batchController.batch.batchCronJson}'),
                onChange: function () { $('#frmMailServer\\:cron').val($(this).cron("value")); },
                periods: ["#{msg['label.cron.minute']}", "#{msg['label.cron.hour']}", "#{msg['label.cron.day']}", "#{msg['label.cron.week']}", "#{msg['label.cron.month']}", "#{msg['label.cron.year']}"],
                days: ["#{msg['label.cron.sunday']}", "#{msg['label.cron.monday']}", "#{msg['label.cron.tuesday']}", "#{msg['label.cron.wednesday']}", "#{msg['label.cron.thursday']}", "#{msg['label.cron.friday']}", "#{msg['label.cron.saturday']}"],
                months: ["#{msg['label.cron.january']}", "#{msg['label.cron.february']}", "#{msg['label.cron.march']}", "#{msg['label.cron.apirl']}", "#{msg['label.cron.may']}", "#{msg['label.cron.june']}", "#{msg['label.cron.july']}", "#{msg['label.cron.august']}", "#{msg['label.cron.september']}", "#{msg['label.cron.october']}", "#{msg['label.cron.november']}", "#{msg['label.cron.december']}"]
            }); // apply cron with default options
        });
    </script>
</ui:composition>
