<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <div id="pageTitle">#{systemBundle['label.system.config.mana']} #{msg['symbol.paren.left']}#{msg['label.edit']}#{msg['symbol.paren.right']}</div>
    <h:form>
        <h:panelGrid width="100%" styleClass="page-header">
            <f:facet name="header">
                <!-- Content Header (Page header) -->
                <div class="row">
                    <div class="col-md-6">
                        <h1>
                            #{systemBundle['label.system.config.mana']}
                            <small>#{msg['label.edit']}</small>
                        </h1>
                    </div>
                    <div class="col-md-6 text-right">
                        <p:commandButton actionListener="#{configController.reload()}"
                                         value="#{msg['label.back']}" icon="fa fa-chevron-circle-left" process="@this"
                                         update="mainContent" onstart="start()" onsuccess="finish()">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.message.confirm.back']}" icon="ui-icon-alert"/>
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton actionListener="#{configController.delete(configController.config)}"
                                         value="#{msg['label.delete']}" icon="fa fa-trash" process="@this"
                                         update=":growl, mainContent" onstart="start()" onsuccess="finish()"
                                         rendered="#{not empty configController.config.configKey and sec.hasMethod('ConfigController', 'delete')}">
                            <p:confirm header="#{msg['label.confirm']}" message="#{msg['label.confirm.delete']}#{msg['symbol.ideographicperiod']}" icon="ui-icon-alert" />
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.create']}" actionListener="#{configController.onCreate()}"
                                         update=":growl, mainContent"
                                         title="#{msg['label.create']}" icon="fa fa-check-circle" onstart="start()" onsuccess="finish()"
                                         rendered="#{empty configController.config.configKey}">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:commandButton value="#{msg['label.update']}" actionListener="#{configController.onUpdate()}"
                                         update=":growl, mainContent"
                                         title="#{msg['label.update']}" icon="fa fa-check-circle" onstart="start()" onsuccess="finish()"
                                         rendered="#{not empty configController.config.configKey}">
                            <f:param name="force" value="true"/>
                        </p:commandButton>
                        <p:outputPanel styleClass="ui-groupbutton" rendered="#{not empty configController.config.configKey}">
                            <p:commandButton title="#{msg['label.previous']}" icon="fa fa-angle-left" styleClass="btn btn-default"
                                             update=":growl, mainContent"
                                             disabled="#{configController.itemViewIndex le 0}"
                                             actionListener="#{configController.updateByIndex(configController.itemViewIndex-1)}"/>
                            <p:commandButton value="#{configController.itemViewIndex+1}/#{configController.list.size()}" styleClass="ui-corner-none"/>
                            <p:commandButton title="#{msg['label.next']}" icon="fa fa-angle-right" styleClass="ui-corner-right" 
                                             update=":growl, mainContent"
                                             disabled="#{configController.itemViewIndex + 1 ge configController.list.size()}"
                                             actionListener="#{configController.updateByIndex(configController.itemViewIndex+1)}"/>
                        </p:outputPanel>
                        <p:commandButton value="#{msg['label.print']}" title="#{msg['label.print']}" icon="fa fa-print" rendered="#{not empty configController.config.configKey and sec.hasMethod('ConfigController', 'print')}">
                            <p:printer target="printArea"/>
                        </p:commandButton>
                    </div>
                </div>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="#{msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                    <p:commandButton value="#{msg['label.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>
            </f:facet>
        </h:panelGrid>
        <p:outputPanel id="printArea" styleClass="box">
            <div class="box-body">
                <table class="table">
                    <tbody>
                        <tr>
                            <td>
                                <p:outputLabel value="#{systemBundle['label.system.config.group']}" for="config_group"/>
                            </td>
                            <td colspan="3">
                                <p:inputText id="config_group" placeholder="#{systemBundle['label.system.config.group']}" value="#{configController.config.configGroup}" 
                                             style="width: 100%" required="true" readonly="true" label="#{systemBundle['label.system.config.group']}"/>
                                <p:message for="config_group" />
                            </td>
                        </tr>
                        <tr>
                            <td width="80">
                                <p:outputLabel value="#{systemBundle['label.system.config.name']}" for="config_key"/>
                            </td>
                            <td colspan="3">
                                <p:inputText id="config_key" placeholder="#{systemBundle['label.system.config.name']}" value="#{configController.config.configKey}" 
                                             style="width: 100%" required="true" readonly="true" label="#{systemBundle['label.system.config.name']}"/>
                                <p:message for="config_key" />
                                <h:inputHidden value="${configController.config.configType}"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <p:outputLabel value="#{systemBundle['label.system.config.setting']}" for="config_value"/>
                            </td>
                            <td colspan="3">
                                <c:choose>
                                    <c:when test="#{configController.config.configKey eq 'DEFAULT_PAGE'}">
                                        <p:selectOneMenu id="config_value" value="#{configController.config.configValue}" 
                                                         style="width: 100%" required="true" label="#{systemBundle['label.system.config.setting']}">
                                            <f:selectItems value="#{configController.modules}" />
                                        </p:selectOneMenu>
                                    </c:when>
                                    <c:when test="#{configController.config.configKey eq 'SOFTPHONE_MODE'}">
                                        <p:selectOneMenu id="config_value" value="#{configController.config.configValue}" 
                                                         style="width: 100%" required="true" label="#{systemBundle['label.system.config.setting']}">
                                            <f:selectItem itemLabel="Twilio" itemValue="twilio"/>
                                            <f:selectItem itemLabel="iTelpy" itemValue="itelpy"/>
                                        </p:selectOneMenu>
                                    </c:when>
                                    <c:when test="#{configController.config.configType eq 1}">
                                        <p:inputSwitch id="config_value" value="#{configController.config.configValue}" style="width: 40px" onLabel="#{systemBundle['label.system.config.setting.on']}" offLabel="#{systemBundle['label.system.config.setting.off']}"/>
                                    </c:when>
                                    <c:otherwise>
                                        <p:inputText id="config_value" placeholder="#{systemBundle['label.system.config.setting']}" value="#{configController.config.configValue}" 
                                                     style="width: 100%" required="true" label="#{systemBundle['label.system.config.setting']}"/>
                                    </c:otherwise>
                                </c:choose>
                                <p:message for="config_value" />
                            </td>
                        </tr>
                        <tr>
                            <td>#{systemBundle['label.system.config.status']}</td>
                            <td><p:inputSwitch value="#{configController.config.configDeletedLabel}" style="width: 80px" onLabel="#{systemBundle['label.system.config.status.use']}" offLabel="#{systemBundle['label.system.config.status.del']}"/></td>
                        </tr>
                        <tr>
                            <td>
                                <p:outputLabel value="#{systemBundle['label.system.config.note']}" for="config_note"/>
                            </td>
                            <td colspan="3">
                                <p:inputTextarea id="config_note" placeholder="#{systemBundle['label.system.config.note']}" value="#{configController.config.configNote}" 
                                                 style="width: 100%" rows="3"/>
                            </td>
                        </tr>
                    </tbody>    
                </table>
            </div><!-- /.box-body -->
        </p:outputPanel><!-- /.box -->
    </h:form>
</ui:composition>

