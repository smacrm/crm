<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html">
    <p:growl id="dialog_growl" showDetail="false" life="3000" />
    
    <ui:include src="/blocks/common/locale.xhtml"/>
    
    <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="${msg['label.yes']}" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
        <p:commandButton value="${msg['label.no']}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
    </p:confirmDialog>
    
    <div class="div_panelGridDialog">
        <p:panelGrid styleClass="panelGridDialog panelGrid_td_line_height ui-panelgrid-color" id="panelGridCust">
            <p:row>
                <p:column>
                    <h:outputText value="${issue['label.cust_cooperation_name']}" /><font>*</font>
                </p:column>
                <p:column>
                    <p:selectOneMenu value="#{customerController.customer.custCooperationId}" converter="gnext.converter.smart">
                        <f:attribute name="title" value="${issue['label.cust_cooperation_name']}"/>
                        <f:selectItem itemLabel="--" itemValue="" />
                        <f:selectItems value="#{issueController.select.get('cust_cooperation_id')}"/>
                    </p:selectOneMenu>
                </p:column>
                <p:column>
                    <h:outputText value="#{msg['label.state']}" />
                </p:column>
                <p:column>
                    <h:outputText
                        rendered="#{customerController.customer.custStatus != null}"
                        value="#{customerController.getStatusOfSpecialCustomer(customerController.customer.custStatus)}"
                        style="padding: 0.7em;"
                        styleClass="label label-success"/>
                </p:column>
            </p:row>

            <p:row>
                <p:column>
                    <h:outputText value="${issue['label.cust_code']}" /><font>*</font>
                </p:column>
                <p:column>
                    <p:inputText value="#{customerController.customer.custCode}" maxlength="20" >
                        <f:validator validatorId="gnext.validator.LengthValidator" />
                        <f:attribute name="max" value="20"/>
                        <f:attribute name="title" value="${issue['label.cust_code']}"/>
                    </p:inputText>
                </p:column>
                <p:column>
                    <h:outputText value="${issue['label.cust_special_name']}" /><font>*</font>
                </p:column>
                <p:column>
                    <p:selectOneMenu value="#{customerController.customer.custSpecialId}" converter="gnext.converter.smart">
                        <f:attribute name="title" value="${issue['label.cust_special_name']}"/>
                        <f:selectItem itemLabel="--" itemValue="" />
                        <f:selectItems value="#{issueController.select.get('cust_special_id')}"/>
                    </p:selectOneMenu>
                </p:column>
            </p:row>

            <c:set var="index" value="0"/>
            <c:forEach var="custName" items="#{customerController.getByType(1)}" varStatus="custNameStatus">
                <c:if test="#{custName.custType eq 1}">
                    <p:row>
                        <p:column>
                            <h:outputText value="${issue['label.name_kana']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.name_kana']} ${(index+1)}" rendered="${(index > 0)}" />
                            <font>*</font>
                        </p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{custName.custData1}" maxlength="70">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="min" value="3"/>
                                <f:attribute name="max" value="70"/>
                                <f:attribute name="title" value="${issue['label.name_kana']}"/>
                            </p:inputText>
                            <p:outputLabel value="-"/>
                            <p:inputText value="#{custName.custData2}" maxlength="70">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="70"/>
                                <f:attribute name="title" value="${issue['label.name_kana']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <h:outputText value="${issue['label.name_hira']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.name_hira']} ${(index+1)}" rendered="${(index > 0)}" />
                            <font>*</font>
                        </p:column>
                        <p:column colspan="3">
                            <p:inputText value="#{custName.custData3}" maxlength="70">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="min" value="3"/>
                                <f:attribute name="max" value="70"/>
                                <f:attribute name="title" value="${issue['label.name_hira']}"/>
                            </p:inputText>
                            <p:outputLabel value="-"/>
                            <p:inputText value="#{custName.custData4}" maxlength="70">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="70"/>
                                <f:attribute name="title" value="${issue['label.name_hira']}"/>
                            </p:inputText>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.addSpecicalData(1)}"
                                           update="panelGridCust,dialog_growl"
                                           disabled="#{customerController.getByType(1).size() gt 4}"
                                           rendered="${index == 0}">
                                <span class="fa fa-plus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.removeSpecicalData(1, custName.custDataSpecialId)}"
                                           update="panelGridCust,dialog_growl"
                                           rendered="${index > 0}">
                                <span class="fa fa-minus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                        </p:column>
                    </p:row>
                    <c:set var="index" value="${index + 1}"/>
                </c:if>
            </c:forEach>

            <p:row>
                <p:column>
                    <h:outputText value="${issue['label.sex']}" />
                </p:column>
                <p:column>
                    <p:selectOneButton value="#{customerController.customer.custSexId}" converter="gnext.converter.smart">
                        <f:selectItems value="#{issueController.select.get('cust_sex_id')}"/>
                    </p:selectOneButton>
                </p:column>
                <p:column>
                    <h:outputText value="${issue['label.age']}" />
                </p:column>
                <p:column>
                    <p:selectOneMenu value="#{customerController.customer.custAgeId}" converter="gnext.converter.smart" title="${issue['label.age']}">
                        <f:selectItem itemLabel="--" itemValue="" noSelectionOption="true"/>
                        <f:selectItems value="#{issueController.select.get('cust_age_id')}"/>
                    </p:selectOneMenu>
                </p:column>
            </p:row>

            <c:set var="index" value="0"/>
            <c:forEach var="custAddress" items="#{customerController.getByType(2)}" varStatus="custAddressStatus">
                <c:if test="#{custAddress.custType eq 2}">
                    <p:row>
                        <p:column>
                            <h:outputText value="${issue['label.post']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.post']} ${(index+1)}" rendered="${(index > 0)}" />
                        </p:column>
                        <p:column>
                            <p:inputText value="#{custAddress.custData1}" styleClass="input_post" maxlength="8">
                                <p:ajax event="blur" update="customer_city_#{index} customer_address_#{index} customer_address_kana_#{index}"
                                        listener="#{customerController.onBlurSpecialCustomerPost}">
                                </p:ajax>
                                <f:param name="custId" value="#{custId}"/>
                                <p:keyFilter regEx="/[0-9]/i" preventPaste="false"/>
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="8"/>
                                <f:attribute name="title" value="${issue['label.post']}"/>
                                <f:attribute name="input_post_index" value="#{index}"/>
                            </p:inputText>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.addSpecicalData(2)}"
                                           update="panelGridCust,dialog_growl"
                                           disabled="#{customerController.getByType(2).size() gt 4}"
                                           rendered="${index == 0}">
                                <span class="fa fa-plus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.removeSpecicalData(2, custAddress.custDataSpecialId)}"
                                           update="panelGridCust,dialog_growl"
                                           rendered="${index > 0}">
                                <span class="fa fa-minus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column>
                            <h:outputText value="${issue['label.city']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.city']} ${(index+1)}" rendered="${(index > 0)}" />
                        </p:column>
                        <p:column>
                            <p:selectOneMenu value="#{custAddress.custData2}" id="customer_city_#{index}" title="${issue['label.city']}">
                                <f:selectItem itemLabel="--" itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{customerController.prefecturesSelectItems}" var="city" itemValue="#{city.value.prefectureId}" itemLabel="#{city.label}"/>
                            </p:selectOneMenu>
                        </p:column>
                    </p:row>
                    <p:row>
                        <p:column>
                            <h:outputText value="${issue['label.address']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.address']} ${(index+1)}" rendered="${(index > 0)}" />
                        </p:column>
                        <p:column>
                            <p:inputText value="#{custAddress.custData3}" styleClass="input_address" maxlength="150" id="customer_address_#{index}">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="150"/>
                                <f:attribute name="title" value="${issue['label.address']}"/>
                            </p:inputText>
                        </p:column>
                        <p:column>
                            <h:outputText value="${issue['label.address_kana']}" rendered="${(index == 0)}" />
                            <h:outputText value="${issue['label.address_kana']} ${(index+1)}" rendered="${(index > 0)}" />
                        </p:column>
                        <p:column>
                            <p:inputText value="#{custAddress.custData4}" styleClass="input_address" maxlength="200" id="customer_address_kana_#{index}">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="200"/>
                                <f:attribute name="title" value="${issue['label.address_kana']}"/>
                            </p:inputText>
                        </p:column>
                    </p:row>
                    <c:set var="index" value="${index + 1}"/>
                </c:if>
            </c:forEach>

            <!-- tel -->
            <c:forEach var="tel" items="#{customerController.customer.tel}" varStatus="telStatus">
                <p:row>
                    <p:column>
                        <h:outputText value="${issue['label.tel']}" rendered="${(telStatus.index == 0)}" />
                        <h:outputText value="${issue['label.tel']} ${(telStatus.index+1)}" rendered="${(telStatus.index > 0)}" />
                    </p:column>
                    <p:column>
                        <p:inputText value="#{tel.custTargetData}" styleClass="input_tel callInputGridTel_${customer.tabIdx}_${(telStatus.index+1)}" maxlength="15">
                            <p:keyFilter regEx="/[0-9\-\+]/i" preventPaste="false"/>
                            <f:attribute name="title" value="${issue['label.tel']}"/>
                        </p:inputText>
                        <p:commandLink 
                            actionListener="#{customerController.addTarget(2)}"
                            update="panelGridCust,dialog_growl"
                            oncomplete="callInputKeyUp(false, 'callInputGridTel_');callInputKeyUp(true, 'callInputGridTel_');"
                            rendered="${telStatus.index == 0}"
                            disabled="#{customerController.customer.tel.size() gt 4}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-plus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                        <p:commandLink
                            actionListener="#{customerController.removeTarget(tel)}"
                            update="panelGridCust" process="@this"
                            oncomplete="callInputKeyUp(false, 'callInputGridTel_');callInputKeyUp(true, 'callInputGridTel_');"
                            rendered="${telStatus.index > 0}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-minus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                    </p:column>
                    <p:column>
                        <h:outputText value="${issue['label.session']}" />
                    </p:column>
                    <p:column style="white-space: nowrap">
                        <p:selectOneMenu value="${tel.custTargetClass}" converter="gnext.converter.smart">
                            <f:selectItems value="#{issueController.select.get('cust_tel_session_id')}"/>
                        </p:selectOneMenu>
                    </p:column>
                </p:row>
            </c:forEach>

            <!-- mobile -->
            <c:forEach var="mobile" items="#{customerController.customer.mobile}" varStatus="mobileStatus">
                <p:row>
                    <p:column>
                        <h:outputText value="${issue['label.mobile']}" rendered="${(mobileStatus.index == 0)}" />
                        <h:outputText value="${issue['label.mobile']} ${(mobileStatus.index+1)}" rendered="${(mobileStatus.index > 0)}" />
                    </p:column>
                    <p:column>
                        <p:inputText value="#{mobile.custTargetData}" styleClass="input_tel callInputGridMobile_${customer.tabIdx}_${(mobileStatus.index+1)}" maxlength="15">
                            <f:attribute name="title" value="#{issue['label.mobile']}"/>
                            <p:keyFilter regEx="/[0-9\-\+]/i" preventPaste="false"/>
                        </p:inputText>
                        <p:commandLink 
                            actionListener="#{customerController.addTarget(3)}"
                            update="panelGridCust,dialog_growl"
                            oncomplete="callInputKeyUp(false, 'callInputGridMobile_');callInputKeyUp(true, 'callInputGridMobile_');"
                            rendered="#{mobileStatus.index == 0}"
                            disabled="#{customerController.customer.mobile.size() gt 4}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-plus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                        <p:commandLink
                            actionListener="#{customerController.removeTarget(mobile)}"
                            update="panelGridCust"
                            process="@this"
                            oncomplete="callInputKeyUp(false, 'callInputGridMobile_');callInputKeyUp(true, 'callInputGridMobile_');"
                            rendered="#{mobileStatus.index > 0}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-minus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                    </p:column>
                    <p:column>
                        <h:outputText value="${issue['label.session']}" />
                    </p:column>
                    <p:column style="white-space: nowrap">
                        <p:selectOneMenu value="${mobile.custTargetClass}" converter="gnext.converter.smart">
                            <f:selectItems value="#{issueController.select.get('cust_tel_session_id')}"/>
                        </p:selectOneMenu>
                    </p:column>
                </p:row>
            </c:forEach>

            <c:forEach var="mail" items="#{customerController.customer.mail}" varStatus="mailStatus">
                <p:row>
                    <p:column>
                        <h:outputText value="${issue['label.mail']}" rendered="${(mailStatus.index == 0)}" />
                        <h:outputText value="${issue['label.mail']} ${(mailStatus.index+1)}" rendered="${(mailStatus.index > 0)}" />
                    </p:column>
                    <p:column colspan="3">
                        <p:inputText value="#{mail.custTargetData}" styleClass="input_mail" maxlength="50">
                            <f:validator validatorId="gnext.validator.EmailValidator"/>
                            <f:attribute name="title" value="${issue['label.mail']}"/>
                            <p:keyFilter regEx="/[a-z0-9_\.\-@]/i" preventPaste="false"/>
                        </p:inputText>
                        <p:commandLink 
                            actionListener="#{customerController.addTarget(1)}"
                            update="panelGridCust,dialog_growl"
                            rendered="#{mailStatus.index == 0}"
                            disabled="#{customerController.customer.mail.size() gt 4}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-plus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                        <p:commandLink
                            actionListener="#{customerController.removeTarget(mail)}"
                            update="panelGridCust"
                            process="@this"
                            rendered="#{mailStatus.index > 0}"
                            styleClass="btn btn-xs btn-default">
                            <span class="fa fa-minus-circle"></span>
                            <f:param name="custId" value="#{custId}"/>
                        </p:commandLink>
                    </p:column>
                </p:row>
            </c:forEach>

            <c:set var="index" value="0"/>
            <c:forEach var="custHistory" items="#{customerController.getByType(3)}" varStatus="custHistoryStatus">
                <c:if test="#{custHistory.custType eq 3}">
                    <p:row>
                        <p:column>
                            <h:outputText value="#{cust['label.cust_history_memo']}" />
                        </p:column>
                        <p:column>
                            <p:inputText value="#{custHistory.custData1}" maxlength="150">
                                <f:validator validatorId="gnext.validator.LengthValidator" />
                                <f:attribute name="max" value="150"/>
                                <f:attribute name="title" value="#{cust['label.cust_history_memo']}"/>
                            </p:inputText>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.addSpecicalData(3)}"
                                           update="panelGridCust,dialog_growl"
                                           disabled="#{customerController.getByType(3).size() gt 4}"
                                           rendered="${index == 0}">
                                <span class="fa fa-plus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                            <p:commandLink styleClass="btn btn-xs btn-default"
                                           actionListener="#{customerController.removeSpecicalData(3, custHistory.custDataSpecialId)}"
                                           update="panelGridCust,dialog_growl"
                                           rendered="${index > 0}">
                                <span class="fa fa-minus-circle"></span>
                                <f:param name="custId" value="#{custId}"/>
                            </p:commandLink>
                        </p:column>
                        <p:column>
                            <h:outputText value="#{cust['label.cust_history_last_update']}" />
                        </p:column>
                        <p:column>
                            <p:calendar
                                id="last_update_#{index}"
                                converter="gnext.converter.StringToDateConverter"
                                label="#{cust['label.cust_history_last_update']}"
                                locale="#{loginController.member.locale}"
                                value="#{custHistory.custData2}"
                                pattern="yyyy/MM/dd" mask="true" effect="fold"
                                showOn="button"
                                styleClass="input_datetime">
                                <f:attribute name="title" value="#{cust['label.cust_history_last_update']}"/>
                            </p:calendar>
                        </p:column>
                    </p:row>
                    <c:set var="index" value="${index + 1}"/>
                </c:if>
            </c:forEach>

            <p:row>
                <p:column>
                    <h:outputText value="${issue['label.memo']}" />
                </p:column>
                <p:column colspan="3">
                    <p:inputTextarea value="#{customerController.customer.custMemo}"
                                     rows="3" style="width: 100%" styleClass="input_text_area" maxlength="2000">
                        <f:validator validatorId="gnext.validator.LengthValidator" />
                        <f:attribute name="max" value="200"/>
                        <f:attribute name="title" value="${issue['label.memo']}"/>
                    </p:inputTextarea>
                </p:column>
            </p:row>
        </p:panelGrid>
    </div>
</ui:composition>