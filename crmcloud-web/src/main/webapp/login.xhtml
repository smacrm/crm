<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <f:metadata>
            <f:event type="preRenderView" listener="#{loginController.onPageLoad}" />
        </f:metadata>
        <f:facet name="first">
            <title>${msg['label.page.login']}</title>
            <ui:include src="/blocks/common/meta.xhtml"/>
            <meta http-equiv="pragma" content="no-cache" />
        </f:facet>
        <f:facet name="last">
            <h:outputStylesheet library="bootstrap" name="css/bootstrap.css"  />
            <!-- Font Awesome -->
            <h:outputStylesheet library="fontawesome" name="css/font-awesome.min.css"  />
            <!-- Ionicons -->
            <h:outputStylesheet library="css" name="ionicons.min.css"/>
            <!-- Theme style -->
            <h:outputStylesheet library="dist" name="css/AdminLTE.css"/>
            
            <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
            <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
            <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
            <![endif]-->
            <style>
                .login-page .ui-chkbox .ui-chkbox-label{
                    vertical-align: text-bottom !important;
                }
            </style>
            <h:outputStylesheet library="css" name="growl.css"  />
        </f:facet>
    </h:head>
    <h:body class="hold-transition login-page">
        <f:view locale="#{localeController.locale}">
            <p:growl id="growl" showDetail="false" life="5000" />
            <div class="login-box">
                <div class="login-logo">
                    <c:if test="#{loginController.member.hasRemoteLogo()}">
                        <a href="login.xhtml">
                            <p:graphicImage value="#{loginController.member.streamedContent}" title="#{loginController.member.companyName}" cache="false"/>
                        </a>
                    </c:if>
                </div>
                <!-- /.login-logo -->
                <p:outputPanel styleClass="login-box-body">
                    <p class="login-box-msg"><h:outputLabel value="${msg['label.system.auth']}" /></p>

                    <h:form prependId="false" id="form" onkeypress="if (event.keyCode == 13) { $('#btnLogin').trigger('click'); return false; }">
                        <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
                        <div class="form-group has-feedback">
                            <input type="text" style="display:none" name="j_username" disabled="disabled"/> <!-- Chrome hacking -->
                            <p:inputText value="#{loginController.username}"
                                         maxlength="30" 
                                         id="j_username" 
                                         autocomplete="off"
                                         a:placeholder="${msg['label.loginId']}" 
                                         a:autofocus="true"
                                         styleClass="form-control"
                                        />
                            <span class="glyphicon glyphicon-user form-control-feedback"></span>
                        </div>
                        <div class="form-group has-feedback">
                            <input type="text" style="display:none" name="j_password" disabled="disabled"/> <!-- Chrome hacking -->
                            <p:password value="#{loginController.password}"
                                        maxlength="30" 
                                        id="j_password" 
                                        autocomplete="off"
                                        a:placeholder="${msg['label.password']}"
                                        styleClass="form-control"
                                      />
                            <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                        </div>
                        <p:outputPanel styleClass="form-group" rendered="#{loginController.member.company.companyGlobalLocale eq 1}">
                            <h:selectOneMenu value="#{localeController.locale}"
                                            onchange="submit()"
                                            valueChangeListener="#{localeController.localeChanged}"
                                            styleClass="form-control">
                               <f:selectItems value="#{localeController.locales}" />
                            </h:selectOneMenu>
                        </p:outputPanel>
                        <div class="row">
                            <div class="col-xs-12">
                                <p:commandButton id="btnLoginAction" actionListener="#{loginController.doLogin(false)}"
                                                 styleClass="hide" ajax="false" update="form growl"/>
                                <p:commandButton id="btnLoginActionForceClose" actionListener="#{loginController.doLogin(true)}"
                                                 styleClass="hide" ajax="false" update="form growl"/>
                                <p:commandButton id="btnLogin" actionListener="#{loginController.checkSessionAllow()}"
                                                 value="${msg['label.login']}"
                                                 styleClass="btn btn-primary btn-block btn-flat"
                                                 style="padding: 6px;" update="callbackLoginChecking"/>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <div class="checkbox">
                                    <p:selectBooleanCheckbox id="j_rememberme" value="#{loginController.rememberMe}" styleClass="hide"
                                        title="${msg['label.remember_me']}" itemLabel="${msg['label.remember_me']}"/>
                                </div>
                            </div>
                            <!-- /.col -->
                            <div class="col-xs-6">
                                <div class="checkbox text-right">
                                    <p:commandLink action="/forgotpassword.xhtml?faces-redirect=true" title="${msg['label.password.lost']}" styleClass="link-pass-lost" value="${msg['label.password.lost']}"/>
                                </div>
                                <h:outputText value="${msg['label.system.name']} ${msg['label.app.version']}" style="float: right;"/>
                            </div>
                            <!-- /.col -->
                        </div>
                    </h:form>

                </p:outputPanel>
                <!-- /.login-box-body -->
            </div>
            <!-- /.login-box -->

            <div class="footer-box">
                <h:outputLabel value="#{loginController.member.companyName}" class="company-name" />
                <br />
                <h:outputText value="#{loginController.member.companyCopyRight}" escape="false"/>
            </div>
        <!-- /.footer-box -->
        </f:view>
        <!-- Bootstrap 3.3.6 -->
        <h:outputScript library="bootstrap" name="js/bootstrap.min.js"/>
        <p:outputPanel id="callbackLoginChecking">
            <h:outputScript rendered="#{not empty loginController.showLoginSessionAlert and loginController.showLoginSessionAlert}">
                if(confirm('#{msg['label.closePreviousSession']}')){
                    $("#btnLoginActionForceClose").trigger('click');
                }
            </h:outputScript>
            <h:outputScript rendered="#{not empty loginController.showLoginSessionAlert and not loginController.showLoginSessionAlert}">
                $("#btnLoginAction").trigger('click');
            </h:outputScript>
        </p:outputPanel>
        <h:outputScript rendered="#{not empty param['r'] and param['error'] != null}">
            if(confirm('#{msg['label.confirmUserCannotAccessToViewIssue']}')){
                window.location.href = "#{request.requestURL}?r=#{param['r']}";
            }else{
                window.location.href = "#{request.requestURL}";
            }
        </h:outputScript>
    </h:body>
</html>